var Zino=function(){"use strict";function t(t){for(var e=[],n=void 0;n=C.exec(t);){var r=e.push({name:n[1].toLowerCase(),value:n[2]||n[3]})-1;e[e[r].name]=e[r].value}return e}function e(n,i,o){var a=t(i);return n=n&&n.toLowerCase(),{tagName:n,attributes:a,children:[],parentNode:o,get outerHTML(){var t=[""].concat(this.attributes.map(function(t){return t.name+'="'+t.value+'"'}));return S.indexOf(this.tagName)>=0?"<"+this.tagName+t.join(" ")+"/>":"<"+this.tagName+t.join(" ")+">"+this.innerHTML+"</"+this.tagName+">"},get innerHTML(){return this.children.map(function(t){return t.text||t.outerHTML}).join("")},set innerHTML(t){this.children=r(t).children},get className(){return this.attributes.class||""},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){var n=this;this.attributes[t]!==e&&(this.attributes=this.attributes.filter(function(e){return e.name!==t}),null!==e&&this.attributes.push({name:t,value:e}),this.attributes.forEach(function(t,e){return n.attributes[n.attributes[e].name]=n.attributes[e].value}))},removeChild:function(t){for(var e in this.children)if(this.children[e]===t){delete this.children[e];break}},cloneNode:function(){var t=e(this.tagName,"",this.parentNode);return this.attributes.forEach(function(e){return t.setAttribute(e.name,e.value)}),this.children.forEach(function(e){return t.children.push(e.cloneNode())}),t}}}function n(t,e){var r=t;return{get text(){return r},set text(t){r=t},parentNode:e,cloneNode:function(){return n(r,this.parentNode)}}}function r(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e("root"),i=void 0,o=0,a=r;for(t=t.replace(z,"").replace(/<(script|style)[^>]*?>((?:.|\n)*?)<\/\1>/g,function(t,e,n){return t.replace(n,n.replace(/(['"])(.*?)\1/g,function(t,e,n){return e+n.replace(/</g,"\\x3c")+e}))}).trim();null!==(i=M.exec(t));){var c=void 0,u=t.substring(o,i.index).replace(/^[ \t]+|[ \t]$/g," ");o=i.index+i[0].length,u.length>0&&a.children.push(n(u,a)),i[1]?(c=a,a=a.parentNode):(c=e(i[2],i[3],a),a.children.push(c),!i[4]&&S.indexOf(c.tagName)<0&&(a=c))}var s=t.substr(o);return s&&r.children.push(n(s,r)),r}function i(t,e){var n=[];return e&&void 0!==e.ownerDocument?[].slice.call(e.querySelectorAll(t)):(e&&e.children.forEach(function(e){var r=void 0;void 0===e.text&&(("#"===t[0]&&e.attributes.id===t.substr(1)||(r=t.match(/^\[(\w+)\]/))&&e.attributes[r[1]]||"."===t[0]&&e.className.split(" ").indexOf(t.substr(1))>=0||e.tagName===t.split(/\[\.#/)[0])&&n.push(e),n=n.concat(i(t,e)))}),n)}function o(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return n.forEach(function(e){for(var n in e)("undefined"!=typeof HTMLElement&&e instanceof HTMLElement||void 0!==a(e,n).value&&(!t[n]||a(t,n).writable))&&(t[n]=e[n])}),t}function a(t,e){return U(t)&&Object.getOwnPropertyDescriptor(t,e)||{}}function c(t,e){var n={},r=void 0;return t?e?(Object.keys(t).forEach(function(i,o){if(!(["__vdom","element","parentNode","innerHTML","outerHTML","className"].indexOf(i)>=0||q(t[i])))if(void 0===e[i])n[i]=t[i];else if(Object.keys(e)[o]!==i){var a=Object.keys(e)[o];n[a]=e[a],n[i]=t[i]}else"object"!==I(t[i])||"object"!==I(e[i])?t[i]!==e[i]&&(n[i]=e[i]):(r=c(t[i],e[i]))&&(n[i]=r)}),Object.keys(e).forEach(function(r,i){["__vdom","element","parentNode","innerHTML","outerHTML","className"].indexOf(r)>=0||q(e[r])||void 0===t[r]&&(n[r]=e[r])}),Object.keys(n).length>0&&n):t||!1:e||!1}function u(t,e,n){throw n?new Error("Error while calling "+t+" function of "+e+": "+(n.message||n),n.fileName,n.lineNumber):(n=e,new Error(t+": "+(n.message||n),n.fileName,n.lineNumber))}function s(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}function l(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return void 0!==n.value&&!q(n.value)}function d(t,e,n,r,i){this.message="Unable to locate end of block "+t,this.block=t,this.result=n,this.data=r,this.position=e,this.condition=i,this.name="BlockEndError"}function f(t,e,n){if(void 0!==t.text)return void(t.text=X(t.text,e));t.attributes.forEach(function(r){t.setAttribute(r.name,X(r.value,e,n))});for(var r,i=0,a=t.children.length;r=t.children[i],i<a;i+=1)!function(r,c,u){if(void 0!==u.text)try{u.text=X(u.text,e)}catch(n){if("BlockEndError"===n.name){for(var s=r+1,l=new RegExp("{{\\s*/"+n.block+"\\s*}}","g"),d=null;t.children[s]&&(!t.children[s].text||!(d=t.children[s].text.match(l)));)s+=1;if(d){var h=[u.cloneNode()];h[0].text=h[0].text.substr(n.position);var v=[t.children[s].cloneNode()];v[0].text=v[0].text.split(d[0])[0],u.text=u.text.substr(0,n.position-(n.block.length+5)),t.children[s].text=t.children[s].text.split(d[0]).pop();var p=t.children.slice(r+1,s);if(p=(h[0].text.length>0?h:[]).concat(p,v[0].text.length>0?v:[]),t.children.splice(r+1,s-(r+1)),!1!==n.condition){"object"!==I(n.condition)&&(n.condition=[n.condition]);for(var m in n.condition)!function(e){var i,a=p.map(function(t,r){var i=o({},n.data,n.condition[e],{".index":e,".length":n.condition.length,".":n.condition[e]});return t=t.cloneNode(),f(t,i),t});(i=t.children).splice.apply(i,[r+1,0].concat(D(a))),r+=p.length}(m)}c=t.children.length,f(t.children[r+1],e)}}}else u.attributes.forEach(function(t){u.setAttribute(t.name,X(t.value,e,n))}),f(u,e);i=r,a=c}(i,a,r)}function h(t){t.children&&t.children.forEach(function(t,e,n){if(t.children)h(t);else if(void 0!==t.text){for(var r=1;n[e+r]&&!n[e+r].children&&void 0!==n[e+r].text;)t.text+=n[e+r].text,r+=1;n.splice(e+1,r-1)}})}function v(t,e){var n=r(t);return function(t){var r=n.cloneNode();return f(r,t,e),h(r),r}}function p(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=0;Object.keys(e).forEach(function(o){if(l(e,o)&&"parentNode"!==o&&"tagName"!==o){var a=t instanceof Node||t[o]instanceof Node,c=U(e[o]);if("undefined"!=typeof document&&c&&a)if(void 0===t[o])if("attributes"===r);else if(n[o])if(void 0!==e[o].tagName&&void 0!==n[o].tagName){var u=document.createElement("i");u.innerHTML=n[o].outerHTML,o=parseInt(o,10),t.childNodes[o]?t.replaceChild(u.children[0],t.childNodes[o]):o>=t.childNodes.length?t.appendChild(u.children[0]):t.insertBefore(u.children[0],t.childNodes[o])}else if("children"===r&&e[o].children&&void 0!==n[o].children)p(t.childNodes[o],e[o],n[o]||n,r);else if("children"===r&&void 0!==e[o].text){var s=document.createTextNode(e[o].text);o=parseInt(o,10),t.childNodes[o]?t.replaceChild(s,t.childNodes[o]):o>=t.childNodes.length?t.appendChild(s):t.insertBefore(s,t.childNodes[o])}else"children"===r&&e[o].attributes?p(t.childNodes[o],e[o],n[o]||n,r):t[o]=e[o];else t.childNodes[o-i]&&(t.removeChild(t.childNodes[o-i]),i++);else"children"===r&&1*o>=0?p(t.childNodes[1*o],e[o],n[o]||n,r):"children"===o||"attributes"===o?p(t,e[o],n[o]||n,["children","attributes"].indexOf(r)>=0&&"attributes"!==o?r:o):p(t[o],e[o],n[o]||n,["children","attributes"].indexOf(r)>=0&&"attributes"!==o?r:o);else"attributes"===r?q(t.setAttribute)&&t.setAttribute(o,e[o]):t[o]=e[o]}})}function m(t,e){if(J[t])for(var n in J[t]){var r=J[t][n](e);if(!1===r)break}}function g(t,e){J[t]||(J[t]=[]),J[t].push(e)}function b(t,e){if(!q(e))return void delete J[t];for(var n in J[t])if(J[t][n]===e)return void delete J[t][n]}function x(t,e){g(t,function n(){e.apply(this,arguments),b(t,n)})}function y(t,e,n){if(q(t.addEventListener)){var r=function(e,r){for(var o=i(e,t);o.length>0&&r!==n;){if(o.indexOf(r)>=0)return o[o.indexOf(r)];r=r.parentNode}return!1};e.forEach(function(e){Object.keys(e.handlers).forEach(function(i){t.addEventListener(i,function(t){var o=void 0;(":host"===e.selector||(o=r(e.selector,t.target)))&&(o&&(o.getHost=function(){return n.getHost()}),e.handlers[i].call(o||n,t))},!1)})})}}function N(t,e,n){var o=r(t).children[0],a=o.tagName,c=void 0;e=e.replace(/[^\/]+$/g,""),t=t.replace(new RegExp("<\\/?"+a+"(?:s+[^>]+)?>","ig"),"").replace(/<(style|script)[^>]*>(?:[^\s]|[^\S])*?<\/\1>/g,""),t=v(t,W),K[a]||(H(o),c=T(o,e),K[a]={functions:c,code:t,path:e,tagName:a},n&&i(a,n).forEach(function(t){return w(t,K[a])}))}function E(t,e){if(t.tagName){var n=K[t.tagName.toLowerCase()];if(n&&!t.getAttribute("__ready"))return e&&(n.functions.render=Z),w.call(e?{noEvents:!0}:this,t,n)}}function _(t){j(O(t),t)}function w(t,e){if(!t.__vdom&&e){var n=e.functions,r=void 0;for(var i in n){var a=n[i];["mount","unmount","events","render"].indexOf(i)<0&&(q(a)?t[i]=a.bind(t):t[i]=a)}if(t.children.length>0&&"-shadow-root"===t.children[0].className){var c=t.children[1];c&&"-original-root"===c.className&&(t.__i=c.innerHTML,A(c,t),c.parentNode.removeChild(c)),r=!0}else t.__i=t.innerHTML,A(t),t.innerHTML='<div class="-shadow-root"></div>';Object.defineProperty(t,"body",{set:function(e){t.__i=e,A(t),m("--zino-rerender-tag",t.getHost())},get:function(){return t.__i}}),t.__s=t.setAttribute,t.setAttribute=function(t,e){this.__s(t,e),m("--zino-rerender-tag",this)},t.__vdom={},t.props=o({},n.props,k(t,!0));try{t.mounting=!0,n.mount.call(t),delete t.mounting}catch(e){u("mount",t.tagName,e)}var s=!r&&O.call(this,t)||{events:[]},l=[],d=n.events||[],f=Object.keys(d).filter(function(e){var n=":host"!==e&&e!==t.tagName;return n||l.push({handlers:d[e],selector:e}),n}).map(function(t){return{selector:t,handlers:d[t]}});if(s.events=s.events.concat({childEvents:f,hostEvents:l,tag:this&&this.noEvents?t.tagName:t}),t.attributes.__ready||t.__s("__ready",!0),this&&!0===this.noEvents)return s;j(s,t)}}function O(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K[t.tagName.toLowerCase()],n=[],r=[],a=k(t),u=e.code(a);u.tagName="div",u.setAttribute("class","-shadow-root");for(var s in K)!function(t){i(t,u).forEach(function(e){var i=w.call({noRenderCallback:!0,noEvents:!0},e,K[t]);n=n.concat(i.events),r=r.concat(i.renderCallbacks)})}(s);i("[__ready]",t).forEach(L);var l=i("[__ready]",u);if(t.attributes.__ready&&t.ownerDocument){var d=c(t.__vdom,u);!1!==d&&p(t.children[0],d,u)}else t.children[0].innerHTML=u.innerHTML;return t.__vdom=u,l.length>0&&i("[__ready]",t).forEach(function(t,e){o(t,l[e]),l[e].getHost=V.getHost.bind(t),t.setAttribute=function(e,n){HTMLElement.prototype.setAttribute.call(t,e,n),m("--zino-rerender-tag",t)}}),this&&this.noRenderCall?r.push(e.functions.render.bind(t)):(r.forEach(function(t){return t()}),e.functions.render.call(t)),{events:n,renderCallbacks:r,data:a}}function j(t,e){var n={};t.events.forEach(function(t){var r=t.tag;U(r)||(n[r]=(n[r]||0)+1,r=i(r,e)[n[r]-1]),r.children[0].__eventsAttached||(y(r.children[0],t.childEvents,r),y(r,t.hostEvents,r),r.children[0].__eventsAttached=!0),q(r.onready)&&r.onready()})}function L(t){var e=(t.tagName||"").toLowerCase(),n=K[e];if(n){[].forEach.call(t.attributes,function(t){t.name.indexOf("data-")>=0&&delete Q[t.value]});try{n.functions.unmount.call(t)}catch(t){u("Unable to unmount tag "+e,t)}}}function k(t,e){var n={props:t.props,element:t.element,styles:t.styles,body:t.__i},r={};return[].forEach.call(t.attributes,function(t){var e=t.name.indexOf("data-")>=0&&"--"===t.value.substr(0,2);n[t.name]||(n[t.name]=e?Q[t.value.replace(/^--|--$/g,"")]:t.value),0===t.name.indexOf("data-")&&(r[t.name.replace(/^data-/g,"").replace(/(\w)-(\w)/g,function(t,e,n){return e+n.toUpperCase()})]=n[t.name])}),e?r:n}function A(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,n={};[].forEach.call(t.children,function(t){if(t.tagName){var e=t.tagName.toLowerCase();n[e]?(n[e].isArray||(n[e]=[n[e]],n[e].isArray=!0),n[e].push(t)):n[e]=t}}),e.element=n}function H(t){var e=t.tagName;i("link",t).forEach(function(t){"stylesheet"===t.attributes.type&&m("publish-style",t)}),m("publish-style",i("style",t).map(function(t){return t.innerHTML.replace(/<br>/g,"").replace(/[\r\n]*([^@%\{;\}]+?)\{/gm,function(t,n){var r=n.split(",").map(function(t){return t=t.trim(),t.match(/:host\b/)||t.match(new RegExp("^\\s*"+e+"\\b"))||t.match(/^\s*(?:(?:\d+%)|(?:from)|(?:to)|(?:@\w+)|\})\s*$/)?t:e+" "+t});return t.replace(n,r.join(","))}).replace(/:host\b/gm,e)+"\n"}).join("\n"))}function T(t,e){var n=o({},V);return i("script",t).forEach(function(r){var i=r.innerHTML.trim();if(r.attributes.src)return m("publish-script",r);try{i=i.replace(/\bZino\.import\s*\(/g,'Zino.import.call({path: "'+e+'"}, '),o(n,new Function("return "+i)())}catch(e){u("parse script "+i+" in tag "+t.tagName,e)}}),n}var M=/<(\/?)([\w-]+)([^>]*?)(\/?)>/g,C=/([\w_-]+)=(?:'([^']*?)'|"([^"]*?)")/g,z=/<!--(?:[^-]|-[^-])*-->/g,S="br,img,input,source,hr,link,meta,wainclude".split(","),I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&c.return&&c.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),D=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},U=function(t){return"object"===(void 0===t?"undefined":I(t))},q=function(t){return"function"==typeof t},Z=function(){},B=function(t){return t},P=/\{\{\s*([^\}]+)\s*\}\}\}?/g,$=function(t,e,n){var r=["."],i=e;for(i[t]?r=[t]:t.length>1&&(r=t.split("."));i&&r.length>0;)i=i[r.shift()];return!n&&q(i)&&(i=i.apply(e)),void 0!==i&&null!==i?i:""},F=function(t,e,n,r,i,a){var c=t[0],u=t.substr(1).trim(),s=$(u,e,!0),l="",d="";if("^"===c&&(!s||s&&s.length<=0)?s=!0:"^"===c&&(s=!1),s){U(s)||(s=[s]);for(var f in s)if("isArray"!==f){var h=s[f];if(l=G(n,o({},e,h,{".index":f,".length":s.length,".":h}),o({key:u,condition:s},r),i,a),q(h))try{d+=h(l.content)}catch(t){throw new Error("Unable to run condition function "+l.content+" while parsing template: "+t.message)}else d+=l.content}}return U(l)||(l=G(n,e,o({key:u,condition:s},r),i,a)),[l.lastIndex,d]},G=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o="",a=i,c=void 0,u=void 0,s=void 0,l=void 0,f=function t(n){return q(n)?t(n.apply(e)):n+("number"==typeof n&&null!==n?e.styles&&e.styles.defaultUnit||"px":"")},h=function(t){var n=$(t,e),r="";if(U(n))for(var i in n)r+=i.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})+":"+f(n[i])+";";return r};if(!t.match(P))return{content:t,lastIndex:t.length-1};for(;c=P.exec(t);)if(!(c.index<a))if(o+=t.substr(a,c.index-a),l=c[1][0],u=c[1].substr(1).trim(),s=c[0].length,a=c.index+s,"#^".indexOf(l)>=0){var v=void 0;[u,a,c.index];var p=F(c[1],e,t,n,r+1,a),m=R(p,2);a=m[0],v=m[1],o+=v}else{if("/"===l){if(r<=0)throw new Error("Unexpected end of block "+u);return{lastIndex:a,content:o}}if("!"===l)o+="";else if("%"===l)o+=u.split(/\s*,\s*/).map(h).join("");else if("+"===l){var g=$(u,e),b=(n.resolveData||B)(u,g);o+="--"+b+"--"}else o+="{"===l?$(u,e):(""+$(c[1],e)||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}if(o+=t.substr(a),r>0)throw new d(n.key,i,o,e,n.condition);return{content:o,lastIndex:t.length-1}},X=function(t,e,n){var r=G(t,e,n);return r&&r.content||""},J={},K={},Q={},V={props:{},mount:Z,unmount:Z,render:Z,getHost:function(){return this},setProps:function(t,e){var n=this.getHost();U(t)?o(n.props,t):n.props[t]=e,n.mounting||m("--zino-rerender-tag",n)}},W={resolveData:function(t,e){var n=s();return Q[n]=e,n}};g("--zino-unmount-tag",L),g("--zino-mount-tag",E);var Y=window.zinoTagRegistry||{},tt=void 0,et=[],nt=new MutationObserver(function(t){t.forEach(function(t){var e=t.addedNodes,n=t.removedNodes;e.length>0?[].forEach.call(e,function(t){(t.children&&i("*",t)||[]).concat(t).forEach(function(t){return m("--zino-mount-tag",t)})}):n.length>0&&[].forEach.call(n,function(t){(t.children&&i("[__ready]",t)||[]).concat(t).forEach(function(t){return m("--zino-unmount-tag",t)})})})}),rt=tt={on:g,one:x,off:b,trigger:m,fetch:function(t,e,n,r){if(n&&Y[t]&&!Y[t].callback)return e(Y[t]);if(U(Y[t]))return Y[t].callback.push(e);if(Y[t]=r||{callback:[e]},!r){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){if(4===i.readyState){var e=Y[t].callback;200===i.status&&(Y[t]=i.responseText),n||delete Y[t],e.forEach(function(t){return t(i.responseText)})}},i.send()}},import:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z,n=(this.path||"")+t;tt.fetch(n,function(t){N(t,n,document.body),e()},!0)}};return window.Zino=tt,g("publish-style",function(t){if("string"==typeof t&&t.length>0){var e=document.createElement("style");e.innerHTML=t,t=e}t&&document.head.appendChild(t)}),g("publish-script",document.head.appendChild),g("--zino-rerender-tag",function(t){return et.indexOf(t)<0&&et.push(t)}),m("publish-style","[__ready] { contain: content; }"),i('[rel="zino-tag"]',document).forEach(function(t){return tt.import(t.href)}),nt.observe(document.body,{subtree:!0,childList:!0}),requestAnimationFrame(function t(){for(;et.length>0;)_(et.shift());requestAnimationFrame(t)}),rt}();
//# sourceMappingURL=zino.min.js.map