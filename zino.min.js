var Zino=function(){"use strict";function e(e){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.forEach(function(n){for(var r in n)("undefined"!=typeof HTMLElement&&n instanceof HTMLElement||void 0!==t(n,r).value&&(!e[r]||t(e,r).writable))&&(e[r]=n[r])}),e}function t(e,t){return S(e)&&Object.getOwnPropertyDescriptor(e,t)||{}}function n(e,t,n){throw n?new Error("Error while calling "+e+" function of "+t+": "+(n.message||n),n.fileName,n.lineNumber):(n=t,new Error(e+": "+(n.message||n),n.fileName,n.lineNumber))}function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function o(e,t){if(H[e])for(var n in H[e]){var r=H[e][n](t);if(!1===r)break}}function i(e,t){H[e]||(H[e]=[]),H[e].push(t)}function a(e,t){if(!$(t))return void delete H[e];for(var n in H[e])if(H[e][n]===t)return void delete H[e][n]}function c(e,t){i(e,function n(){t.apply(this,arguments),a(e,n)})}function s(e,t,n){if($(e.addEventListener)){var r=function(t,r){for(var o=[].slice.call(e.querySelectorAll(t));o.length>0&&r!==n;){if(o.indexOf(r)>=0)return o[o.indexOf(r)];r=r.parentNode}return!1};t.forEach(function(t){Object.keys(t.handlers).forEach(function(o){e.addEventListener(o,function(e){var i=void 0;(":host"===t.selector||(i=r(t.selector,e.target)))&&(i&&(i.getHost=function(){return n.getHost()}),t.handlers[o].call(i||n,e))},!1)})})}}function u(e){return"[object Array]"===Object.prototype.toString.call(e)}function l(e){q=e}function f(e,t,n){e=e.toLowerCase();var r={tagName:e,attributes:t||{},children:n||[]};return F.indexOf(e)>=0&&M.push(r),r}function d(e,t){var n=[];return e=(e||"").toLowerCase(),"function"==typeof t.getElementsByTagName?[].slice.call(t.getElementsByTagName(e)):(t.children&&(n=n.concat(t.children.filter(function(t){return t.tagName&&t.tagName.toLowerCase()===e})),t.children.forEach(function(t){n=n.concat(d(e,t))})),n)}function h(e){F=e}function p(){var e=M;return M=[],e}function g(e){return e.children?(u(e.children)||(e.children=[e.children]),(u(e)&&e||e.children).map(function(e){if("object"!==(void 0===e?"undefined":k(e)))return""+e;if(u(e))return g(e);var t=[""].concat(Object.keys(e.attributes).map(function(t){return"object"===k(e.attributes[t])?t+'="--'+q(t,e.attributes[t])+'--"':t+'="'+e.attributes[t]+'"'}));return"<"+e.tagName+t.join(" ")+">"+g(e)+"</"+e.tagName+">"}).join("")):""}function m(e,t){var n=void 0;return"object"!==(void 0===e?"undefined":k(e))?n=t.createTextNode(""+e):(n=t.createElement(e.tagName),Object.keys(e.attributes).forEach(function(t){n.setAttribute(t,e.attributes[t])}),e.__vdom&&o("--zino-initialize-node",{tag:n,node:e}),n.innerHTML=g(e)),n}function v(e,t,n){u(t)||(u(t.children)||(t.children=[t.children]),t.tagName!==e.tagName.toLowerCase()?e.parentNode.replaceChild(m(t,n),e):(Object.keys(t.attributes).forEach(function(n){if("object"!==k(t.attributes[n]))e.getAttribute(n)!=t.attributes[n]&&e.setAttribute(n,t.attributes[n]);else if(e.getAttribute(n)&&e.getAttribute(n).match(/^--|--$/g)){var r=q(n,t.attributes[n],e.getAttribute(n).replace(/^--|--$/g,""));e.setAttribute(n,"--"+r+"--")}}),e.attributes.length>Object.keys(t.attributes)&&[].forEach.call(e.attributes,function(n){void 0===t.attributes[n.name]&&e.removeAttribute(n.name)})));var r=u(t)?t:t.children;r.forEach(function(t,r){if(u(t))return v(e,t,n);void 0===e.childNodes[r]?e.appendChild(m(t,n)):3===e.childNodes[r].nodeType?"string"==typeof t&&e.childNodes[r].nodeValue!==t?e.childNodes[r].nodeValue=t:"string"!=typeof t&&e.replaceChild(m(t,n),e.childNodes[r]):1===e.childNodes[r].nodeType&&("object"===(void 0===t?"undefined":k(t))?v(e.childNodes[r],t,n):e.replaceChild(m(t,n),e.childNodes[r]))}),e.childNodes.length>r.length&&[].slice.call(e.childNodes,r.length).forEach(function(t){return e.removeChild(t)})}function b(t,n){var r=t(f),o=r.tagName;D[o]||(C(r),r.functions=e({},R,r.functions),D[o]=r,n&&[].slice.call(d(o,n)).forEach(function(e){return _(e,D[o])}))}function y(e,t){if(e.tagName){var n=D[e.tagName.toLowerCase()];if(n&&!e.getAttribute("__ready"))return t&&(n.functions.render=z),_.call(t?{noEvents:!0}:this,e,n)}}function x(e){N(E(e),e)}function _(e,t){if(!e.__vdom&&t){var n=t.functions,r=void 0;if(e.children.length>0&&e.children[0].attributes&&"-shadow-root"===e.children[0].attributes.class){var i=e.children[1];i&&"-original-root"===i.className&&(e.__i=i.innerHTML,O(i,e),i.parentNode.removeChild(i)),r=!0}else e.__i=e.ownerDocument?e.innerHTML:g(e),O(e),e.innerHTML='<div class="-shadow-root"></div>';o("--zino-initialize-node",{tag:e,node:n}),e.__vdom={};var a=!r&&E.call(this,e)||{events:[]},c=[],s=n.events||[],u=Object.keys(s).filter(function(t){var n=":host"!==t&&t!==e.tagName;return n||c.push({handlers:s[t],selector:t}),n}).map(function(e){return{selector:e,handlers:s[e]}});if(a.events=a.events.concat({childEvents:u,hostEvents:c,tag:this&&this.noEvents?e.tagName:e}),e.attributes.__ready||($(e.__s)?e.__s("__ready",!0):e.attributes.__ready=!0),this&&!0===this.noEvents)return a;N(a,e)}}function w(t){var r=t.tag,i=t.node;for(var a in i){var c=i[a];["mount","unmount","events","render"].indexOf(a)<0&&($(c)?r[a]=c.bind(r):r[a]=c)}if(Object.defineProperty(r,"body",{set:function(e){r.__i=e,O(r),o("--zino-rerender-tag",r.getHost())},get:function(){return r.__i}}),r.__s=r.setAttribute,r.setAttribute=function(e,t){$(this.__s)?this.__s(e,t):this.attributes[e]=t,o("--zino-rerender-tag",this)},r.props=e({},i.props,j(r,!0)),r.ownerDocument)try{r.mounting=!0,i.mount.call(r),delete r.mounting}catch(e){n("mount",r.tagName,e)}}function E(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D[t.tagName.toLowerCase()],r=[],o=[],i=[],a=void 0;l(Z.resolveData);var c=j(t);if(!$(n.render))throw new Error("No render function provided in component "+t.tagName);return h(Object.keys(D)),a=f("div",{class:"-shadow-root"},n.render.call(t,c)),i=i.concat(p()),i.forEach(function(e){var t=_.call({noRenderCallback:!0,noEvents:!0},e,D[e.tagName]);i=i.concat(p()),r=r.concat(t.events),o=o.concat(t.renderCallbacks)}),t.attributes.__ready&&t.ownerDocument?v(t.children[0],a,t.ownerDocument):t.ownerDocument?t.children[0].innerHTML=g(a):t.children[0]=a,t.__vdom=a,t.__subElements=i,i.length>0&&(t.querySelectorAll&&[].slice.call(t.querySelectorAll("[__ready]"))||i).forEach(function(t,n){e(t,i[n]),t.ownerDocument&&w({tag:t,node:D[t.tagName.toLowerCase()].functions}),i[n].getHost=R.getHost.bind(t)}),this&&this.noRenderCall?o.push(n.functions.render.bind(t)):(o.forEach(function(e){return e()}),n.functions.render.call(t)),{events:r,renderCallbacks:o,data:c}}function N(e,t){var n={};e.events.forEach(function(e){var r=e.tag;S(r)||(n[r]=(n[r]||0)+1,r=t.querySelectorAll(r)[n[r]-1]),r.children[0].__eventsAttached||(s(r.children[0],e.childEvents,r),s(r,e.hostEvents,r),r.children[0].__eventsAttached=!0),$(r.onready)&&r.onready()})}function A(e){var t=(e.tagName||"").toLowerCase(),r=D[t];if(r){[].forEach.call(1===e.nodeType&&e.attributes||Object.keys(e.attributes).map(function(t){return{name:t,value:e.attributes[t]}}),function(e){e.name.indexOf("data-")>=0&&delete U[e.value]});try{r.functions.unmount.call(e)}catch(e){n("Unable to unmount tag "+t,e)}}}function j(e,t){var n={props:e.props,element:e.element,styles:e.styles,body:e.__i},r={};return[].forEach.call(1===e.nodeType&&e.attributes||Object.keys(e.attributes).map(function(t){return{name:t,value:e.attributes[t]}}),function(e){var t=e.name.indexOf("data-")>=0&&"string"==typeof e.value&&"--"===e.value.substr(0,2);n[e.name]||(n[e.name]=t?U[e.value.replace(/^--|--$/g,"")]:e.value),0===e.name.indexOf("data-")&&(r[e.name.replace(/^data-/g,"").replace(/(\w)-(\w)/g,function(e,t,n){return t+n.toUpperCase()})]=n[e.name])}),t?r:n}function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n={};[].forEach.call(e.children,function(e){if(e.tagName){var t=e.tagName.toLowerCase();n[t]?(n[t].isArray||(n[t]=[n[t]],n[t].isArray=!0),n[t].push(e)):n[t]=e}}),t.element=n}function C(e){var t=e.tagName;o("publish-style",(e.styles||[]).map(function(e){return e.replace(/[\r\n]*([^@%\{;\}]+?)\{/gm,function(e,n){var r=n.split(",").map(function(e){return e=e.trim(),e.match(/:host\b/)||e.match(new RegExp("^\\s*"+t+"\\b"))||e.match(/^\s*(?:(?:\d+%)|(?:from)|(?:to)|(?:@\w+)|\})\s*$/)?e:t+" "+e});return e.replace(n,r.join(","))}).replace(/:host\b/gm,t)+"\n"}).join("\n"))}function L(e){function t(){return"data"+(0===u?"":"$"+u)}function n(e){var n=void 0,r="",c=0;if(!e.match(V))return r+="'"+e.substr(c).replace(/\n/g,"").replace(/'/g,"\\'")+"', ";for(;n=V.exec(e);)if(!(n.index<c)){var s=e.substring(c,n.index).trim();s.length>0&&(r+="'"+s.replace(/\n/g,"").replace(/'/g,"\\'")+"', "),c=n.index+n[0].length;var l=n[1],f=l.substr(1);if("#"===l[0])r+="spread(toArray("+t()+", '"+f+"').map(function (e, i, a) {\n\t\t\t\t\t\tvar data$"+(u+1)+" = merge({}, data"+(0<=u?"":"$"+u)+", {'.': e, '.index': i, '.length': a.length}, e);\n\t\t\t\t\t\treturn [",u+=1,o=!0,a=!0;else if("/"===l[0]){if(r+="'']; })), ",(u-=1)<0)throw new Error("Unexpected end of block: "+l.substr(1))}else"!"===l[0]?r+="":"^"===l[0]?(r+="(safeAccess("+t()+", '"+f+"') && (typeof safeAccess("+t()+", '"+f+"') === 'boolean' || safeAccess("+t()+", '"+f+"').length > 0)) ? '' : spread([1].map(function() { var data$"+(u+1)+" = merge({}, data"+(0<=u?"":"$"+u)+"); return [",a=!0,u+=1):"%"===l[0]?(r+=l.substr(1).split(/\s*,\s*/).map(function(e){return"renderStyle(safeAccess("+t()+", '"+e+"'), "+t()+")"}).join(" + "),i=!0):"+"===l[0]?r+="safeAccess("+t()+", '"+f+"'), ":"{"!==l[0]?(f=l,r+="safeAccess("+t()+", '"+f+"', true), "):r+="safeAccess("+t()+", '"+f+"'), "}return e.substr(c).length>0&&(r+="'"+e.substr(c).replace(/\n/g,"").replace(/'/g,"\\'")+"', "),r}var r={styles:[],helperFunctions:[G],tagName:"",render:"",functions:""},o=!1,i=!1,a=!1,c=void 0,s=0,u=0,l=[];if(e=e.replace(J,"").replace(/<(script|style)[^>]*?>((?:.|\n)*?)<\/\1>/gi,function(e,t,n){return"style"===t?r.styles.push(n):r.functions+=n.trim().replace(/;$/,""),""}).trim(),!e.match(P))throw console.log(e),new Error("No proper component provided");for(r.tagName=e.match(/^<([\w_-]+)>/)[1].toLowerCase();c=P.exec(e);)if(!(c.index<s)){var f=e.substring(s,c.index).replace(/^[ \t]+|[ \t]$/g," ").trim();if(s=c.index+c[0].length,f.length>0&&(r.render+=n(f)),c[2]!==r.tagName)if(c[1]){var d=l.pop();if(d!==c[2])throw new Error("Unexpected end of tag: "+c[2]+"; expected to end "+d);r.render=r.render.replace(/,\s*$/g,"")+")), "}else{l.push(c[2]);var h=function(e){for(var t="{",r=void 0;r=B.exec(e);)"{"!==t&&(t+=", "),t+='"'+r[1].toLowerCase()+'": '+n(r[2]||r[3]).replace(/,\s*$/,"");return t+"}"}(c[3]);r.render+="new Tag('"+c[2]+"', "+h,c[4]?(r.render+="), ",l.pop()):r.render+=", [].concat("}}if(l.length>0)throw new Error("Unclosed tags: "+l.join(", "));if(u>0)throw new Error("Unexpected end of block");return e.substr(s).trim().length>0&&(r.render+=n(e.substr(s).replace(/^[ \t]+|[ \t]$/g," ").trim())),r.render=r.render.replace(/,\s*$/g,""),o&&(r.helperFunctions.push(K),r.helperFunctions.push(X)),a&&r.helperFunctions.push(I),i&&r.helperFunctions.push(Q),r.functions=r.functions||"{}",r.styles=r.styles.length>0?"styles: "+JSON.stringify(r.styles)+",":"",r.helperFunctions=r.helperFunctions.join("\n"),W.replace(/\{\{([^\}]+)\}\}/g,function(e,t){return r[t]})}function T(e,t){return[].slice.call(t.querySelectorAll(e))}var k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S=function(e){return"object"===(void 0===e?"undefined":k(e))},$=function(e){return"function"==typeof e},z=function(){},H={},F=[],M=[],q=function(e,t){return e},D={},U={},R={props:{},mount:z,unmount:z,render:z,getHost:function(){return this},setProps:function(t,n){var r=this.getHost();S(t)?e(r.props,t):r.props[t]=n,r.mounting||o("--zino-rerender-tag",r)}},Z={resolveData:function(e,t,n){var o=r();return n&&delete U[n],U[o]=t,o}};i("--zino-initialize-node",w),i("--zino-unmount-tag",A),i("--zino-mount-tag",y);var P=/<(\/?)([\w-]+)([^>]*?)(\/?)>/g,B=/([\w_-]+)=(?:'([^']*?)'|"([^"]*?)")/g,J=/<!--(?:[^-]|-[^-])*-->/g,V=/\{\{\s*([^\}]+)\s*\}\}\}?/g,G='function safeAccess(t,e,r){if(!e)return t;if("."===e[0])return t[e];for(e=e.split(".");e.length>0&&void 0!==(t=t[e.shift()]););return"string"==typeof t&&r===!0?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/>/g,"&gt;"):"function"==typeof t?t.call(__i):t||""}',X='function toArray(t,e){var r=safeAccess(t,e);return r?"[object Array]"===Object.prototype.toString.call(r)?r:"function"==typeof r?r():[r]:[]}',I="function spread(t){var e=[];return t.forEach(function(t){e=e.concat(t)}),e}",K="function merge(t){return[].slice.call(arguments,1).forEach(function(e){for(var r in e)t[r]=e[r]}),t}",Q='function renderStyle(t,r){var e="";if(transform=function(t){return"function"==typeof t?transform(t.apply(r)):t+("number"==typeof t&&null!==t?r.styles&&r.styles.defaultUnit||"px":"")},"object"==typeof t)for(var n in t)e+=n.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})+":"+transform(t[n])+";";return e}',W='function (Tag){var __i;{{helperFunctions}};return{tagName:"{{tagName}}",{{styles}}render:function(data){return __i=this,[].concat({{render}})},functions:{{functions}}}}',Y=window.zinoTagRegistry||{},ee=void 0,te=[],ne=new MutationObserver(function(e){e.forEach(function(e){var t=e.addedNodes,n=e.removedNodes;t.length>0?[].forEach.call(t,function(e){(e.children&&T("*",e)||[]).concat(e).forEach(function(e){return o("--zino-mount-tag",e)})}):n.length>0&&[].forEach.call(n,function(e){(e.children&&T("[__ready]",e)||[]).concat(e).forEach(function(e){return o("--zino-unmount-tag",e)})})})}),re=ee={on:i,one:c,off:a,trigger:o,fetch:function(e,t,n,r){if(n&&Y[e]&&!Y[e].callback)return t(Y[e],200);if(S(Y[e]))return Y[e].callback.push(t);if(Y[e]=r||{callback:[t]},!r){var o=new XMLHttpRequest;o.open("GET",e,!0),o.onreadystatechange=function(){if(4===o.readyState){var t=Y[e].callback;200===o.status&&(Y[e]=o.responseText),n||delete Y[e],t.forEach(function(e){return e(o.responseText,o.status)})}},o.send()}},import:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z,n=(this.path||"")+e;ee.fetch(n,function(e,r){var o=n.replace(/[^\/]+$/g,"");if(200===r){var i=void 0;try{0===e.trim().indexOf("<")&&(e=L(e)),i=new Function("return "+e.replace(/\bZino.import\s*\(/g,"Zino.import.call({path: "+JSON.stringify(o)+"}, ").trim().replace(/;$/,""))()}catch(e){throw e.message="Unable to import tag "+n.replace(/.*\//g,"")+": "+e.message,e}i&&b(i,document.body)}t()},!0)}};return window.Zino=ee,i("publish-style",function(e){if("string"==typeof e&&e.length>0){var t=document.createElement("style");t.innerHTML=e,e=t}e&&document.head.appendChild(e)}),i("--zino-rerender-tag",function(e){return te.indexOf(e)<0&&te.push(e)}),o("publish-style","[__ready] { contain: content; }"),T('[rel="zino-tag"]',document).forEach(function(e){return ee.import(e.href)}),ne.observe(document.body,{subtree:!0,childList:!0}),requestAnimationFrame(function e(){for(;te.length>0;)x(te.shift());requestAnimationFrame(e)}),re}();
//# sourceMappingURL=zino.min.js.map