!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Zino=e()}(this,function(){"use strict";function t(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach(function(n){for(var r in n)("undefined"!=typeof HTMLElement&&n instanceof HTMLElement||void 0!==e(n,r).value&&(!t[r]||e(t,r).writable))&&(t[r]=n[r])}),t}function e(t,e){return Object.getOwnPropertyDescriptor(t,e)||{}}function n(t,e,n){throw n?new Error("Error while calling "+t+" function of "+e+": "+(n.message||n),n.fileName,n.lineNumber):(n=e,new Error(t+": "+(n.message||n),n.fileName,n.lineNumber))}function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}function i(t){for(var e=[],n=void 0;null!==(n=$.exec(t));){var r=e.push({name:n[1].toLowerCase(),value:n[2]||n[3]})-1;e[e[r].name]=e[r].value}return e}function o(t,e,n){var r=i(e);return t=t&&t.toLowerCase(),{tagName:t,attributes:r,children:[],parentNode:n,get outerHTML(){var t=[""].concat(this.attributes.map(function(t){return t.name+'="'+t.value+'"'}));return I.indexOf(this.tagName)>=0?"<"+this.tagName+t.join(" ")+"/>":"<"+this.tagName+t.join(" ")+">"+this.innerHTML+"</"+this.tagName+">"},get innerHTML(){return this.children.map(function(t){return t.text||t.outerHTML}).join("")},set innerHTML(t){this.children=a(t).children},get className(){return this.attributes.class||""},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){this.attributes=this.attributes.filter(function(e){return e.name!==t}),null!==e&&this.attributes.push({name:t,value:e}),this.attributes[t]=e},removeChild:function(t){for(var e in this.children)if(this.children[e]===t){delete this.children[e];break}}}}function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o("root"),n=void 0,r=0,i=e;for(t=t.replace(z,"").trim();null!==(n=S.exec(t));){var a=void 0,c=t.substring(r,n.index).replace(/^[ \t]+|[ \t]$/g," ");r=n.index+n[0].length,c.length>0&&i.children.push({text:c}),n[1]?(a=i,i=i.parentNode):(a=new o(n[2],n[3],i),i.children.push(a),!n[4]&&I.indexOf(a.tagName)<0&&(i=a))}var u=t.substr(r);return u&&e.children.push({text:u}),e}function c(t,e){var n=function(t,e,n){return e?"^"===e?0===t.indexOf(n):"$"===e?t.lastIndexOf(n)+n.length===t.length:"*"===e&&t.indexOf(n)>=0:t===n},r=[];return e&&void 0!==e.ownerDocument?[].slice.call(e.querySelectorAll(t)):(e&&e.children.forEach(function(e){var i=void 0;e.text||(("#"===t[0]&&e.attributes.id===t.substr(1)||(i=t.match(/^\[(\w+)\]/))&&e.attributes[i[1]]||(i=t.match(/^\[(\w+)(\^|\$|\*)?=(?:'([^']*)'|"([^"]*)"|([^\]])*)\]/))&&e.attributes[i[1]]&&n(e.attributes[i[1]],i[2],i[3]||i[4]||i[5])||"."===t[0]&&e.attributes.class&&e.attributes.class.split(" ").indexOf(t.substr(1))>=0||e.tagName===t.split(/\[\.#/)[0])&&r.push(e),r=r.concat(c(t,e)))}),r)}function u(t,e){if(R[t])for(var n in R[t]){var r=R[t][n],i=r(e);if(!1===i)break}}function s(t,e){R[t]||(R[t]=[]),R[t].push(e)}function l(t,e){if("function"!=typeof e)return void delete R[t];for(var n in R[t])if(R[t][n]===e)return void delete R[t][n]}function f(t,e){var n=this,r=arguments,i=void 0;s(t,i=function(){e.apply(n,r),l(t,i)})}function d(t,e,n){if("function"==typeof t.addEventListener){var r=function(e,r){for(var i=c(e,t);i.length>0&&r!==n;){if(i.indexOf(r)>=0)return i[i.indexOf(r)];r=r.parentNode}return!1};e.forEach(function(e){Object.keys(e.handlers).forEach(function(i){t.addEventListener(i,function(t){var o=void 0;(":host"===e.selector||(o=r(e.selector,t.target)))&&(o&&(o.getHost=function(){return n.getHost()}),e.handlers[i].call(o||n,t))},!1)})})}}function h(t,e,n){var r=a(t).children[0],i=r.tagName,o=void 0;e=e.replace(/[^\/]+$/g,""),t=t.replace(new RegExp("<\\/?"+i+"(?:s+[^>]+)?>","ig"),"").replace(/<(style|script)[^>]*>(?:[^\s]|[^\S])*?<\/\1>/g,""),r.code=t,U[i]||(w(r),o=E(r,e),U[i]={functions:o,code:t,path:e,tagName:i},n&&c(i,n).forEach(function(t){return p(t,U[i])}))}function v(t,e){if(t.tagName){var n=U[t.tagName.toLowerCase()];if(n&&!t.getAttribute("__ready"))return e&&(n.functions.render=L),p.call(e?{noEvents:!0}:this,t,n)}}function p(e,r){if(!e.__s&&r){var i=r.functions,o=void 0;for(var a in i){var c=i[a];["mount","unmount","events","render"].indexOf(a)<0&&(e[a]="function"==typeof c?c.bind(e):c)}if(e.children.length>0&&"-shadow-root"===e.children[0].className){var u=e.children[1];u&&"-original-root"===u.className&&(e.__i=u.innerHTML,x(u,e),u.parentNode.removeChild(u)),o=!0}else e.__i=e.innerHTML,x(e),e.innerHTML='<div class="-shadow-root"></div>';Object.defineProperty(e,"body",{set:function(t){e.__i=t,x(e),m(e)},get:function(){return e.__i}}),e.__s=e.__s||e.setAttribute,e.setAttribute=function(t,n){e.__s(t,n),m(e)},e.props=t({},i.props,y(e,!0));try{e.mounting=!0,i.mount.call(e),delete e.mounting}catch(t){n("mount",e.tagName,t)}var s=!o&&m.call(this,e)||{events:[]},l=[],f=i.events||[],d=Object.keys(f).filter(function(t){var n=":host"!==t&&t!==e.tagName;return n||l.push({handlers:f[t],selector:t}),n}).map(function(t){return{selector:t,handlers:f[t]}});if(s.events=s.events.concat({childEvents:d,hostEvents:l,tag:this&&this.noEvents?e.tagName:e}),e.attributes.__ready||e.__s("__ready",!0),this&&!0===this.noEvents)return s;g(s,e)}}function m(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U[e.tagName.toLowerCase()],r=[],i=[],o=y(e),u=M(n.code,o,P),s=a(u);for(var l in U)!function(t){c(t,s).forEach(function(e){var n=p.call({noRenderCallback:!0,noEvents:!0},e,U[t]);r=r.concat(n.events),i=i.concat(n.renderCallbacks)})}(l);c("[__ready]",e).forEach(b);var f=c("[__ready]",s);return e.children[0].innerHTML=s.innerHTML,f.length>0&&c("[__ready]",e).forEach(function(e,n){t(e,f[n]),f[n].getHost=D.getHost.bind(e)}),this&&this.noRenderCall?i.push(n.functions.render.bind(e)):(i.forEach(function(t){return t()}),n.functions.render.call(e)),{events:r,renderCallbacks:i,data:o}}function g(t,e){var n={};t.events.forEach(function(t){var r=t.tag;O(r)||(n[r]=(n[r]||0)+1,r=c(r,e)[n[r]-1]),d(r.children[0],t.childEvents,r),d(r,t.hostEvents,r),j(r.onready)&&r.onready()})}function b(t){var e=(t.tagName||"").toLowerCase(),r=U[e];if(r){[].forEach.call(t.attributes,function(t){t.name.indexOf("data-")>=0&&delete Z[t.value]});try{r.functions.unmount.call(t)}catch(t){n("Unable to unmount tag "+e,t)}}}function y(t,e){var n={props:t.props,element:t.element,styles:t.styles,body:t.__i},r={};return[].forEach.call(t.attributes,function(t){var e=t.name.indexOf("data-")>=0&&"--"===t.value.substr(0,2);n[t.name]||(n[t.name]=e?Z[t.value.replace(/^--|--$/g,"")]:t.value),0===t.name.indexOf("data-")&&(r[t.name.replace(/^data-/g,"").replace(/(\w)-(\w)/g,function(t,e,n){return e+n.toUpperCase()})]=n[t.name])}),e?r:n}function x(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,n={};[].forEach.call(t.children,function(t){if(!t.text){var e=t.tagName.toLowerCase();n[e]?(n[e].isArray||(n[e]=[n[e]],n[e].isArray=!0),n[e].push(t)):n[e]=t}}),e.element=n}function w(t){var e=t.tagName;c("link",t).forEach(function(t){"stylesheet"===t.attributes.type&&(t.attributes.id=e+"-external-styles",u("publish-style",t))}),u("publish-style",c("style",t).map(function(t){return t.children[0].text.replace(/<br>/g,"").replace(/[\r\n]*([^@%\{;\}]+?)\{/gm,function(t,n){var r=n.split(",").map(function(t){return t=t.trim(),t.match(/:host\b/)||t.match(new RegExp("^\\s*"+e+"\\b"))||t.match(/^\s*(?:(?:\d+%)|(?:from)|(?:to)|(?:@\w+)|\})\s*$/)?t:e+" "+t});return t.replace(n,r.join(","))}).replace(/:host\b/gm,e)+"\n"}).join("\n"))}function E(e,r){var i=t({},D);return c("script",e).forEach(function(o){var a=o.children.length>0&&o.children[0].text.trim();if(o.attributes.src)return u("publish-script",o);try{a=a.replace(/\bZino\.import\s*\(/g,'Zino.import.call({path: "'+r+'"}, ').replace(/;$/g,""),t(i,new Function("return "+a)())}catch(t){n("parse script "+a+" in tag "+e.tagName,t)}}),i}var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&c.return&&c.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),O=function(t){return"object"===(void 0===t?"undefined":_(t))},j=function(t){return"function"==typeof t},L=function(){},H=function(t){return t},C=/\{\{\s*([^\}]+)\s*\}\}\}?/g,k=function(t,e,n){var r=["."],i=e;for(i[t]?r=[t]:t.length>1&&(r=t.split("."));i&&r.length>0;)i=i[r.shift()];return!n&&j(i)&&(i=i.apply(e)),void 0!==i&&null!==i?i:""},T=function(e,n,r,i,o,a){var c=e[0],u=e.substr(1).trim(),s=k(u,n,!0),l="",f="";if("^"===c&&(!s||s&&s.length<=0)?s=!0:"^"===c&&(s=!1),s){O(s)||(s=[s]);for(var d in s)if("isArray"!==d){var h=s[d];if(l=A(r,t({},n,h,{".index":d,".length":s.length,".":h}),i,o,a),j(h))try{f+=h(l.content)}catch(t){throw new Error("Unable to run condition function "+l.content+" while parsing template: "+t.message)}else f+=l.content}}return O(l)||(l=A(r,n,i,o,a)),[l.lastIndex,f]},A=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o="",a=i,c=void 0,u=void 0,s=void 0,l=void 0,f=function t(n){return j(n)?t(n.apply(e)):n+("number"==typeof n&&null!==n?e.styles&&e.styles.defaultUnit||"px":"")},d=function(t){var n=k(t,e),r="";if(O(n))for(var i in n)r+=i.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})+":"+f(n[i])+";";return r};if(!t.match(C))return{content:t,lastIndex:t.length-1};for(;null!==(c=C.exec(t));)if(!(c.index<a))if(o+=t.substr(a,c.index-a),l=c[1][0],u=c[1].substr(1).trim(),s=c[0].length,a=c.index+s,"#^@".indexOf(l)>=0){var h=void 0,v=T(c[1],e,t,n,r+1,a),p=N(v,2);a=p[0],h=p[1],o+=h}else{if("/"===l){if(r<=0)throw new Error("Unexpected end of block "+u);return{lastIndex:a,content:o}}if(">"===l)o+=(n.resolvePartial||H)(u,e);else if("!"===l)o+="";else if("%"===l)o+=u.split(/\s*,\s*/).map(d).join("");else if("+"===l){var m=k(u,e),g=(n.resolveData||H)(u,m);o+="--"+g+"--"}else o+="{"===l?k(u,e):(""+k(c[1],e)||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}if(o+=t.substr(a),r>0)throw new Error("Unable to locate end of block for "+t.substr(i));return{content:o,lastIndex:t.length-1}},M=function(t,e,n){var r=A(t,e,n);return r&&r.content||""},S=/<(\/?)([\w-]+)([^>]*?)(\/?)>/g,$=/([\w_-]+)=(?:'([^']*?)'|"([^"]*?)")/g,z=/<!--(?:[^-]|-[^-])*-->/g,I="br,img,input,source,hr,link,meta,wainclude".split(","),R={},U={},Z={},D={props:{},mount:L,unmount:L,render:L,getHost:function(){return this},setProps:function(e,n){var r=this.getHost();if(O(e)?t(r.props,e):r.props[e]=n,!r.mounting){g(m(r),r)}}},P={resolveData:function(t,e){var n=r();return Z[n]=e,n}};s("--zino-unmount-tag",b),s("--zino-mount-tag",v);var q=window.zinoTagRegistry||{},F=void 0,G=new MutationObserver(function(t){t.forEach(function(t){var e=t.addedNodes,n=t.removedNodes;e.length>0?[].forEach.call(e,function(t){(t.children&&c("*",t)||[]).concat(t).forEach(function(t){return u("--zino-mount-tag",t)})}):n.length>0&&[].forEach.call(n,function(t){(t.children&&c("[__ready]",t)||[]).concat(t).forEach(function(t){return u("--zino-unmount-tag",t)})})})}),X=F={on:s,one:f,off:l,trigger:u,fetch:function(t,e,n,r){if(n&&q[t]&&!q[t].callback)return e(q[t]);if(O(q[t]))return q[t].callback.push(e);if(q[t]=r||{callback:[e]},!r){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){if(4===i.readyState){var e=q[t].callback;200===i.status&&n&&(q[t]=i.responseText),n||delete q[t],e.forEach(function(t){return t(i.responseText)})}},i.send()}},import:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:L,n=(this.path||"")+t;F.fetch(n,function(t){h(t,n,document.body),e()},!0)}};return window.Zino=F,s("publish-style",function(t){if("string"==typeof t&&t.length>0){var e=document.createElement("style");e.innerHTML=t,t=e}t&&document.head.appendChild(t)}),s("publish-script",document.head.appendChild),u("publish-style","[__ready] { contain: content; }"),c('[rel="zino-tag"]',document).forEach(function(t){return F.import(t.href)}),G.observe(document.body,{subtree:!0,childList:!0}),X});
//# sourceMappingURL=zino.min.js.map