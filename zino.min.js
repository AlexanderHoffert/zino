var Zino=function(){"use strict";function t(t){for(var e=[],n=void 0;n=T.exec(t);){var r=e.push({name:n[1].toLowerCase(),value:n[2]||n[3]})-1;e[e[r].name]=e[r].value}return e}function e(n,i,o){var a=t(i),c=!0,u=0,s="";return n=n&&n.toLowerCase(),{tagName:n,attributes:a,children:[],parentNode:o,dirty:function(){c=!0,this.parentNode&&this.parentNode.dirty()},get outerHTML(){var t=[""].concat(this.attributes.map(function(t){return t.name+'="'+t.value+'"'}));return M.indexOf(this.tagName)>=0?"<"+this.tagName+t.join(" ")+"/>":"<"+this.tagName+t.join(" ")+">"+this.innerHTML+"</"+this.tagName+">"},get innerHTML(){return(c||this.children.length!==u)&&(s=this.children.map(function(t){return t.text||t.outerHTML}).join(""),c=!1,u=this.children.length),s},set innerHTML(t){this.dirty(),this.children=r(t).children},get className(){return this.attributes.class||""},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){var n=this;this.attributes[t]!==e&&(this.attributes=this.attributes.filter(function(e){return e.name!==t}),null!==e&&this.attributes.push({name:t,value:e}),this.attributes.forEach(function(t,e){return n.attributes[n.attributes[e].name]=n.attributes[e].value}),this.parentNode&&this.parentNode.dirty())},removeChild:function(t){for(var e in this.children)if(this.children[e]===t){delete this.children[e];break}},cloneNode:function(){var t=e(this.tagName,"",this.parentNode);return this.attributes.forEach(function(e){return t.setAttribute(e.name,e.value)}),this.children.forEach(function(e){return t.children.push(e.cloneNode())}),t}}}function n(t,e){var r=t;return{get text(){return r},set text(t){r=t,this.parentNode.dirty()},parentNode:e,cloneNode:function(){return n(r,this.parentNode)}}}function r(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e("root"),i=void 0,o=0,a=r;for(t=t.replace(C,"").replace(/<(script|style)[^>]*?>((?:.|\n)*?)<\/\1>/g,function(t,e,n){return t.replace(n,n.replace(/(['"])(.*?)\1/g,function(t,e,n){return e+n.replace(/</g,"\\x3c")+e}))}).trim();null!==(i=H.exec(t));){var c=void 0,u=t.substring(o,i.index).replace(/^[ \t]+|[ \t]$/g," ");o=i.index+i[0].length,u.length>0&&a.children.push(n(u,a)),i[1]?(c=a,a=a.parentNode):(c=e(i[2],i[3],a),a.children.push(c),!i[4]&&M.indexOf(c.tagName)<0&&(a=c))}var s=t.substr(o);return s&&r.children.push(n(s,r)),r}function i(t,e){var n=[];return e&&void 0!==e.ownerDocument?[].slice.call(e.querySelectorAll(t)):(e&&e.children.forEach(function(e){var r=void 0;e.text||(("#"===t[0]&&e.attributes.id===t.substr(1)||(r=t.match(/^\[(\w+)\]/))&&e.attributes[r[1]]||"."===t[0]&&e.className.split(" ").indexOf(t.substr(1))>=0||e.tagName===t.split(/\[\.#/)[0])&&n.push(e),n=n.concat(i(t,e)))}),n)}function o(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return n.forEach(function(e){for(var n in e)("undefined"!=typeof HTMLElement&&e instanceof HTMLElement||void 0!==a(e,n).value&&(!t[n]||a(t,n).writable))&&(t[n]=e[n])}),t}function a(t,e){return R(t)&&Object.getOwnPropertyDescriptor(t,e)||{}}function c(t,e){var n={},r=void 0;return Object.keys(t).forEach(function(i,o){if("parentNode"!==i&&l(t,i))if(void 0===e[i])n[i]=t[i];else if(Object.keys(e)[o]!==i){var a=Object.keys(e)[o];n[a]=e[a],n[i]=t[i]}else"object"!==z(t[i])||"object"!==z(e[i])?t[i]!==e[i]&&(n[i]=e[i]):(r=c(t[i],e[i]))&&(n[i]=r)}),Object.keys(e).forEach(function(r,i){l(e,r)&&void 0===t[r]&&(n[r]=e[r])}),Object.keys(n).length>0&&n}function u(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Object.keys(e).forEach(function(r){if(l(e,r)&&"parentNode"!==r&&"tagName"!==r)if("undefined"!=typeof document&&"object"===z(e[r]))if(void 0===t[r])if("attributes"===n);else if(void 0!==e[r].tagName){var i=document.createElement("i");i.innerHTML=e[r].outerHTML,r=parseInt(r,10),r>=t.childNodes.length?t.appendChild(i.children[0]):t.insertBefore(i.children[0],t.childNodes[r])}else if("children"===n){var o=document.createTextNode(e[r].text);r=parseInt(r,10),r>=t.childNodes.length?t.appendChild(o):t.insertBefore(o,t.childNodes[r])}else t[r]=e[r];else"children"===r||"attributes"===r?u(t,e[r],r):u(t[r],e[r],"attributes"===n?n:r);else"attributes"===n?U(t.setAttribute)&&t.setAttribute(r,e[r]):t[r]=e[r]})}function s(t,e,n){throw n?new Error("Error while calling "+t+" function of "+e+": "+(n.message||n),n.fileName,n.lineNumber):(n=e,new Error(t+": "+(n.message||n),n.fileName,n.lineNumber))}function l(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return void 0!==n.value&&!U(n.value)}function f(t,e,n,r,i){this.message="Unable to locate end of block "+t,this.block=t,this.result=n,this.data=r,this.position=e,this.condition=i,this.name="BlockEndError"}function d(t,e){if(void 0!==t.text)return void(t.text=F(t.text,e));t.attributes.forEach(function(n){t.setAttribute(n.name,F(n.value,e))});for(var n,r=0,i=t.children.length;n=t.children[r],r<i;r+=1)!function(n,a,c){if(void 0!==c.text)try{c.text=F(c.text,e)}catch(r){if("BlockEndError"===r.name){for(var u=n+1,s=new RegExp("{{\\s*/"+r.block+"\\s*}}","g"),l=null;t.children[u]&&(!t.children[u].text||!(l=t.children[u].text.match(s)));)u+=1;if(l){var f=[c.cloneNode()];f[0].text=f[0].text.substr(r.position);var h=[t.children[u].cloneNode()];h[0].text=h[0].text.split(l[0])[0],c.text=c.text.substr(0,r.position-(r.block.length+5)),t.children[u].text=t.children[u].text.split(l[0]).pop();var v=t.children.slice(n+1,u);if(v=(f[0].text.length>0?f:[]).concat(v,h[0].text.length>0?h:[]),t.children.splice(n+1,u-(n+1)),!1!==r.condition){"object"!==z(r.condition)&&(r.condition=[r.condition]);for(var p in r.condition)!function(e){var i,a=v.map(function(t,n){var i=o({},r.data,r.condition[e],{".index":e,".length":r.condition.length,".":r.condition[e]});return t=t.cloneNode(),d(t,i),t});(i=t.children).splice.apply(i,[n+1,0].concat(I(a))),n+=v.length}(p)}a=t.children.length,d(t.children[n+1],e)}}}else c.attributes.forEach(function(t){c.setAttribute(t.name,F(t.value,e))}),d(c,e);r=n,i=a}(r,i,n)}function h(t){var e=r(t);return function(t){var n=void 0;return n=e.cloneNode(),d(n,t),n.data=t,n}}function v(t,e){if(G[t])for(var n in G[t]){var r=G[t][n](e);if(!1===r)break}}function p(t,e){G[t]||(G[t]=[]),G[t].push(e)}function g(t,e){if(!U(e))return void delete G[t];for(var n in G[t])if(G[t][n]===e)return void delete G[t][n]}function m(t,e){p(t,function n(){e.apply(this,arguments),g(t,n)})}function b(t,e,n){if(U(t.addEventListener)){var r=function(e,r){for(var o=i(e,t);o.length>0&&r!==n;){if(o.indexOf(r)>=0)return o[o.indexOf(r)];r=r.parentNode}return!1};e.forEach(function(e){Object.keys(e.handlers).forEach(function(i){t.addEventListener(i,function(t){var o=void 0;(":host"===e.selector||(o=r(e.selector,t.target)))&&(o&&(o.getHost=function(){return n.getHost()}),e.handlers[i].call(o||n,t))},!1)})})}}function y(t,e,n){var o=r(t).children[0],a=o.tagName,c=void 0;e=e.replace(/[^\/]+$/g,""),t=t.replace(new RegExp("<\\/?"+a+"(?:s+[^>]+)?>","ig"),"").replace(/<(style|script)[^>]*>(?:[^\s]|[^\S])*?<\/\1>/g,""),t=h(t),X[a]||(A(o),c=L(o,e),X[a]={functions:c,code:t,path:e,tagName:a},n&&i(a,n).forEach(function(t){return x(t,X[a])}))}function E(t,e){if(t.tagName){var n=X[t.tagName.toLowerCase()];if(n&&!t.getAttribute("__ready"))return e&&(n.functions.render=q),x.call(e?{noEvents:!0}:this,t,n)}}function N(t){_(w(t),t)}function x(t,e){if(!t.__s&&e){var n=e.functions,r=void 0;for(var i in n){var a=n[i];["mount","unmount","events","render"].indexOf(i)<0&&(U(a)?t[i]=a.bind(t):t[i]=a)}if(t.children.length>0&&"-shadow-root"===t.children[0].className){var c=t.children[1];c&&"-original-root"===c.className&&(t.__i=c.innerHTML,k(c,t),c.parentNode.removeChild(c)),r=!0}else t.__i=t.innerHTML,k(t),t.innerHTML='<div class="-shadow-root"></div>';Object.defineProperty(t,"body",{set:function(e){t.__i=e,k(t),v("--zino-rerender-tag",t.getHost())},get:function(){return t.__i}}),t.__s=t.setAttribute,t.setAttribute=function(e,n){t.__s(e,n),v("--zino-rerender-tag",t.getHost())},t.__vdom={},t.props=o({},n.props,O(t,!0));try{t.mounting=!0,n.mount.call(t),delete t.mounting}catch(e){s("mount",t.tagName,e)}var u=!r&&w.call(this,t)||{events:[]},l=[],f=n.events||[],d=Object.keys(f).filter(function(e){var n=":host"!==e&&e!==t.tagName;return n||l.push({handlers:f[e],selector:e}),n}).map(function(t){return{selector:t,handlers:f[t]}});if(u.events=u.events.concat({childEvents:d,hostEvents:l,tag:this&&this.noEvents?t.tagName:t}),t.attributes.__ready||t.__s("__ready",!0),this&&!0===this.noEvents)return u;_(u,t)}}function w(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X[t.tagName.toLowerCase()],n=[],r=[],a=O(t),s=e.code(a);s.tagName="div",s.setAttribute("class","-shadow-root");for(var l in X)!function(t){i(t,s).forEach(function(e){var i=x.call({noRenderCallback:!0,noEvents:!0},e,X[t]);n=n.concat(i.events),r=r.concat(i.renderCallbacks)})}(l);i("[__ready]",t).forEach(j);var f=i("[__ready]",s);if(t.ownerDocument){var d=c(t.__vdom,s);!1!==d&&(u(t.children[0],d),t.__vdom=s)}else t.children[0].innerHTML=s.innerHTML;return f.length>0&&i("[__ready]",t).forEach(function(t,e){o(t,f[e]),f[e].getHost=K.getHost.bind(t)}),this&&this.noRenderCall?r.push(e.functions.render.bind(t)):(r.forEach(function(t){return t()}),e.functions.render.call(t)),{events:n,renderCallbacks:r,data:a}}function _(t,e){var n={};t.events.forEach(function(t){var r=t.tag;R(r)||(n[r]=(n[r]||0)+1,r=i(r,e)[n[r]-1]),b(r.children[0],t.childEvents,r),b(r,t.hostEvents,r),U(r.onready)&&r.onready()})}function j(t){var e=(t.tagName||"").toLowerCase(),n=X[e];if(n){[].forEach.call(t.attributes,function(t){t.name.indexOf("data-")>=0&&delete J[t.value]});try{n.functions.unmount.call(t)}catch(t){s("Unable to unmount tag "+e,t)}}}function O(t,e){var n={props:t.props,element:t.element,styles:t.styles,body:t.__i},r={};return[].forEach.call(t.attributes,function(t){var e=t.name.indexOf("data-")>=0&&"--"===t.value.substr(0,2);n[t.name]||(n[t.name]=e?J[t.value.replace(/^--|--$/g,"")]:t.value),0===t.name.indexOf("data-")&&(r[t.name.replace(/^data-/g,"").replace(/(\w)-(\w)/g,function(t,e,n){return e+n.toUpperCase()})]=n[t.name])}),e?r:n}function k(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,n={};[].forEach.call(t.children,function(t){if(!t.text){var e=t.tagName.toLowerCase();n[e]?(n[e].isArray||(n[e]=[n[e]],n[e].isArray=!0),n[e].push(t)):n[e]=t}}),e.element=n}function A(t){var e=t.tagName;i("link",t).forEach(function(t){"stylesheet"===t.attributes.type&&v("publish-style",t)}),v("publish-style",i("style",t).map(function(t){return t.innerHTML.replace(/<br>/g,"").replace(/[\r\n]*([^@%\{;\}]+?)\{/gm,function(t,n){var r=n.split(",").map(function(t){return t=t.trim(),t.match(/:host\b/)||t.match(new RegExp("^\\s*"+e+"\\b"))||t.match(/^\s*(?:(?:\d+%)|(?:from)|(?:to)|(?:@\w+)|\})\s*$/)?t:e+" "+t});return t.replace(n,r.join(","))}).replace(/:host\b/gm,e)+"\n"}).join("\n"))}function L(t,e){var n=o({},K);return i("script",t).forEach(function(r){var i=r.innerHTML.trim();if(r.attributes.src)return v("publish-script",r);try{i=i.replace(/\bZino\.import\s*\(/g,'Zino.import.call({path: "'+e+'"}, '),o(n,new Function("return "+i)())}catch(e){s("parse script "+i+" in tag "+t.tagName,e)}}),n}var H=/<(\/?)([\w-]+)([^>]*?)(\/?)>/g,T=/([\w_-]+)=(?:'([^']*?)'|"([^"]*?)")/g,C=/<!--(?:[^-]|-[^-])*-->/g,M="br,img,input,source,hr,link,meta,wainclude".split(","),z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&c.return&&c.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),I=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},R=function(t){return"object"===(void 0===t?"undefined":z(t))},U=function(t){return"function"==typeof t},q=function(){},D=function(t){return t},Z=/\{\{\s*([^\}]+)\s*\}\}\}?/g,B=function(t,e,n){var r=["."],i=e;for(i[t]?r=[t]:t.length>1&&(r=t.split("."));i&&r.length>0;)i=i[r.shift()];return!n&&U(i)&&(i=i.apply(e)),void 0!==i&&null!==i?i:""},P=function(t,e,n,r,i,a){var c=t[0],u=t.substr(1).trim(),s=B(u,e,!0),l="",f="";if("^"===c&&(!s||s&&s.length<=0)?s=!0:"^"===c&&(s=!1),s){R(s)||(s=[s]);for(var d in s)if("isArray"!==d){var h=s[d];if(l=$(n,o({},e,h,{".index":d,".length":s.length,".":h}),o({key:u,condition:s},r),i,a),U(h))try{f+=h(l.content)}catch(t){throw new Error("Unable to run condition function "+l.content+" while parsing template: "+t.message)}else f+=l.content}}return R(l)||(l=$(n,e,o({key:u,condition:s},r),i,a)),[l.lastIndex,f]},$=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o="",a=i,c=void 0,u=void 0,s=void 0,l=void 0,d=function t(n){return U(n)?t(n.apply(e)):n+("number"==typeof n&&null!==n?e.styles&&e.styles.defaultUnit||"px":"")},h=function(t){var n=B(t,e),r="";if(R(n))for(var i in n)r+=i.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})+":"+d(n[i])+";";return r};if(!t.match(Z))return{content:t,lastIndex:t.length-1};for(;c=Z.exec(t);)if(!(c.index<a))if(o+=t.substr(a,c.index-a),l=c[1][0],u=c[1].substr(1).trim(),s=c[0].length,a=c.index+s,"#^".indexOf(l)>=0){var v=void 0;[u,a,c.index];var p=P(c[1],e,t,n,r+1,a),g=S(p,2);a=g[0],v=g[1],o+=v}else{if("/"===l){if(r<=0)throw new Error("Unexpected end of block "+u);return{lastIndex:a,content:o}}if("!"===l)o+="";else if("%"===l)o+=u.split(/\s*,\s*/).map(h).join("");else if("+"===l){var m=B(u,e),b=(n.resolveData||D)(u,m);o+="--"+b+"--"}else o+="{"===l?B(u,e):(""+B(c[1],e)||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}if(o+=t.substr(a),r>0)throw new f(n.key,i,o,e,n.condition);return{content:o,lastIndex:t.length-1}},F=function(t,e,n){var r=$(t,e,n);return r&&r.content||""},G={},X={},J={},K={props:{},mount:q,unmount:q,render:q,getHost:function(){return this},setProps:function(t,e){var n=this.getHost();R(t)?o(n.props,t):n.props[t]=e,n.mounting||v("--zino-rerender-tag",n)}};p("--zino-unmount-tag",j),p("--zino-mount-tag",E);var Q=window.zinoTagRegistry||{},V=void 0,W=[],Y=new MutationObserver(function(t){t.forEach(function(t){var e=t.addedNodes,n=t.removedNodes;e.length>0?[].forEach.call(e,function(t){(t.children&&i("*",t)||[]).concat(t).forEach(function(t){return v("--zino-mount-tag",t)})}):n.length>0&&[].forEach.call(n,function(t){(t.children&&i("[__ready]",t)||[]).concat(t).forEach(function(t){return v("--zino-unmount-tag",t)})})})}),tt=V={on:p,one:m,off:g,trigger:v,fetch:function(t,e,n,r){if(n&&Q[t]&&!Q[t].callback)return e(Q[t]);if(R(Q[t]))return Q[t].callback.push(e);if(Q[t]=r||{callback:[e]},!r){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){if(4===i.readyState){var e=Q[t].callback;200===i.status&&(Q[t]=i.responseText),n||delete Q[t],e.forEach(function(t){return t(i.responseText)})}},i.send()}},import:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q,n=(this.path||"")+t;V.fetch(n,function(t){y(t,n,document.body),e()},!0)}};return window.Zino=V,p("publish-style",function(t){if("string"==typeof t&&t.length>0){var e=document.createElement("style");e.innerHTML=t,t=e}t&&document.head.appendChild(t)}),p("publish-script",document.head.appendChild),p("--zino-rerender-tag",function(t){return W.push(t)}),v("publish-style","[__ready] { contain: content; }"),i('[rel="zino-tag"]',document).forEach(function(t){return V.import(t.href)}),Y.observe(document.body,{subtree:!0,childList:!0}),requestAnimationFrame(function t(){W.forEach(N),W=[],requestAnimationFrame(t)}),tt}();
//# sourceMappingURL=zino.min.js.map