var Zino=function(){"use strict";function t(t){for(var n=arguments.length,r=Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return r.forEach(function(n){for(var r in n)("undefined"!=typeof HTMLElement&&n instanceof HTMLElement||void 0!==e(n,r).value&&(!t[r]||e(t,r).writable))&&(t[r]=n[r])}),t}function e(t,e){return T(t)&&Object.getOwnPropertyDescriptor(t,e)||{}}function n(t,e,n){throw n?new Error("Error while calling "+t+" function of "+e+": "+(n.message||n),n.fileName,n.lineNumber):(n=e,new Error(t+": "+(n.message||n),n.fileName,n.lineNumber))}function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}function a(t){return"[object Array]"===Object.prototype.toString.call(t)}function o(t,e,n){t=t.toLowerCase();var r={tagName:t,attributes:e||{},children:n||[]};return H.indexOf(t)>=0&&$.push(r),r}function i(t){H=t}function c(){var t=$;return $=[],t}function s(t){return t.children?(a(t.children)||(t.children=[t.children]),(a(t)&&t||t.children).map(function(t){if("object"!==(void 0===t?"undefined":C(t)))return""+t;if(a(t))return s(t);var e=[""].concat(Object.keys(t.attributes).map(function(e){return e+'="'+t.attributes[e]+'"'}));return"<"+t.tagName+e.join(" ")+">"+s(t)+"</"+t.tagName+">"}).join("")):""}function u(t){var e=void 0;return"object"!==(void 0===t?"undefined":C(t))?e=document.createTextNode(""+t):(e=document.createElement(t.tagName),Object.keys(t.attributes).forEach(function(n){e.setAttribute(n,t.attributes[n])}),t.__vdom&&x(e,t),e.innerHTML=s(t)),e}function l(t,e,n){a(e)||(a(e.children)||(e.children=[e.children]),e.tagName!==t.tagName.toLowerCase()?t.parentNode.replaceChild(u(e),t):(Object.keys(e.attributes).forEach(function(a){if("object"!==C(e.attributes[a]))t.getAttribute(a)!=e.attributes[a]&&t.setAttribute(a,e.attributes[a]);else if(t.getAttribute(a)&&n[t.getAttribute(a).replace(/^--|--$/g,"")]!==e.attributes[a]){var o=r();delete n[t.getAttribute(a).replace(/^--|--$/g,"")],n[o]=e.attributes[a],t.setAttribute(a,"--"+o+"--")}}),t.attributes.length>Object.keys(e.attributes)&&[].forEach.call(t.attributes,function(n){void 0===e.attributes[n.name]&&t.removeAttribute(n.name)})));var o=a(e)?e:e.children;o.forEach(function(e,r){if(a(e))return l(t,e,n);void 0===t.childNodes[r]?t.appendChild(u(e)):3===t.childNodes[r].nodeType?"string"==typeof e&&t.childNodes[r].nodeValue!==e?t.childNodes[r].nodeValue=e:"string"!=typeof e&&t.replaceChild(u(e),t.childNodes[r]):1===t.childNodes[r].nodeType&&("object"===(void 0===e?"undefined":C(e))?l(t.childNodes[r],e,n):t.replaceChild(u(e),t.childNodes[r]))}),t.childNodes.length>o.length&&[].slice.call(t.childNodes,o.length).forEach(function(e){return t.removeChild(e)})}function f(t,e){if(M[t])for(var n in M[t]){var r=M[t][n](e);if(!1===r)break}}function d(t,e){M[t]||(M[t]=[]),M[t].push(e)}function h(t,e){if(!S(e))return void delete M[t];for(var n in M[t])if(M[t][n]===e)return void delete M[t][n]}function g(t,e){d(t,function n(){e.apply(this,arguments),h(t,n)})}function p(t,e,n){if(S(t.addEventListener)){var r=function(e,r){for(var a=[].slice.call(t.querySelectorAll(e));a.length>0&&r!==n;){if(a.indexOf(r)>=0)return a[a.indexOf(r)];r=r.parentNode}return!1};e.forEach(function(e){Object.keys(e.handlers).forEach(function(a){t.addEventListener(a,function(t){var o=void 0;(":host"===e.selector||(o=r(e.selector,t.target)))&&(o&&(o.getHost=function(){return n.getHost()}),e.handlers[a].call(o||n,t))},!1)})})}}function m(e,n){var r=e(o),a=r.tagName;z[a]||(j(r),r.functions=t({},q,r.functions),z[a]=r,n&&[].slice.call(n.querySelectorAll(a)).forEach(function(t){return y(t,z[a])}))}function v(t,e){if(t.tagName){var n=z[t.tagName.toLowerCase()];if(n&&!t.getAttribute("__ready"))return e&&(n.functions.render=k),y.call(e?{noEvents:!0}:this,t,n)}}function b(t){E(_(t),t)}function y(t,e){if(!t.__vdom&&e){var n=e.functions,r=void 0;if(t.children.length>0&&t.children[0].attributes&&"-shadow-root"===t.children[0].attributes.class){var a=t.children[1];a&&"-original-root"===a.className&&(t.__i=a.innerHTML,A(a,t),a.parentNode.removeChild(a)),r=!0}else t.__i=t instanceof Node?t.innerHTML:s(t),A(t),t.innerHTML='<div class="-shadow-root"></div>';x(t,n),t.__vdom={};var o=!r&&_.call(this,t)||{events:[]},i=[],c=n.events||[],u=Object.keys(c).filter(function(e){var n=":host"!==e&&e!==t.tagName;return n||i.push({handlers:c[e],selector:e}),n}).map(function(t){return{selector:t,handlers:c[t]}});if(o.events=o.events.concat({childEvents:u,hostEvents:i,tag:this&&this.noEvents?t.tagName:t}),t.attributes.__ready||(S(t.__s)?t.__s("__ready",!0):t.attributes.__ready=!0),this&&!0===this.noEvents)return o;E(o,t)}}function x(e,r){for(var a in r){var o=r[a];["mount","unmount","events","render"].indexOf(a)<0&&(S(o)?e[a]=o.bind(e):e[a]=o)}if(Object.defineProperty(e,"body",{set:function(t){e.__i=t,A(e),f("--zino-rerender-tag",e.getHost())},get:function(){return e.__i}}),e.__s=e.setAttribute,e.setAttribute=function(t,e){S(this.__s)?this.__s(t,e):this.attributes[t]=e,f("--zino-rerender-tag",this)},e.props=t({},r.props,w(e,!0)),e.ownerDocument)try{e.mounting=!0,r.mount.call(e),delete e.mounting}catch(t){n("mount",e.tagName,t)}}function _(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z[e.tagName.toLowerCase()],a=[],u=[],d=[],h=void 0,g=w(e);return S(r.render)&&(i(Object.keys(z)),h=o("div",{class:"-shadow-root"},r.render(g))),d=d.concat(c()),d.forEach(function(t){var e=y.call({noRenderCallback:!0,noEvents:!0},t,z[t.tagName]);d=d.concat(c()),a=a.concat(e.events),u=u.concat(e.renderCallbacks)}),e.attributes.__ready&&e.ownerDocument?l(e.children[0],h,F):e.ownerDocument?e.children[0].innerHTML=s(h):e.children[0]=h,e.__vdom=h,e.__subElements=d,d.length>0&&(e.querySelectorAll&&[].slice.call(e.querySelectorAll("[__ready]"))||d).forEach(function(e,r){if(t(e,d[r]),e.ownerDocument)try{e.mounting=!0,z[e.tagName.toLowerCase()].functions.mount.call(e),delete e.mounting}catch(t){n("mount",e.tagName,t)}d[r].getHost=q.getHost.bind(e),e.setAttribute=function(t,n){HTMLElement.prototype.setAttribute.call(e,t,n),f("--zino-rerender-tag",e)}}),this&&this.noRenderCall?u.push(r.functions.render.bind(e)):(u.forEach(function(t){return t()}),r.functions.render.call(e)),{events:a,renderCallbacks:u,data:g}}function E(t,e){var n={};t.events.forEach(function(t){var r=t.tag;T(r)||(n[r]=(n[r]||0)+1,r=e.querySelectorAll(r)[n[r]-1]),r.children[0].__eventsAttached||(p(r.children[0],t.childEvents,r),p(r,t.hostEvents,r),r.children[0].__eventsAttached=!0),S(r.onready)&&r.onready()})}function N(t){var e=(t.tagName||"").toLowerCase(),r=z[e];if(r){[].forEach.call(1===t.nodeType&&t.attributes||Object.keys(t.attributes).map(function(e){return{name:e,value:t.attributes[e]}}),function(t){t.name.indexOf("data-")>=0&&delete F[t.value]});try{r.functions.unmount.call(t)}catch(t){n("Unable to unmount tag "+e,t)}}}function w(t,e){var n={props:t.props,element:t.element,styles:t.styles,body:t.__i},r={};return[].forEach.call(1===t.nodeType&&t.attributes||Object.keys(t.attributes).map(function(e){return{name:e,value:t.attributes[e]}}),function(t){var e=t.name.indexOf("data-")>=0&&"string"==typeof t.value&&"--"===t.value.substr(0,2);n[t.name]||(n[t.name]=e?F[t.value.replace(/^--|--$/g,"")]:t.value),0===t.name.indexOf("data-")&&(r[t.name.replace(/^data-/g,"").replace(/(\w)-(\w)/g,function(t,e,n){return e+n.toUpperCase()})]=n[t.name])}),e?r:n}function A(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,n={};[].forEach.call(t.children,function(t){if(t.tagName){var e=t.tagName.toLowerCase();n[e]?(n[e].isArray||(n[e]=[n[e]],n[e].isArray=!0),n[e].push(t)):n[e]=t}}),e.element=n}function j(t){var e=t.tagName;f("publish-style",(t.styles||[]).map(function(t){return t.replace(/[\r\n]*([^@%\{;\}]+?)\{/gm,function(t,n){var r=n.split(",").map(function(t){return t=t.trim(),t.match(/:host\b/)||t.match(new RegExp("^\\s*"+e+"\\b"))||t.match(/^\s*(?:(?:\d+%)|(?:from)|(?:to)|(?:@\w+)|\})\s*$/)?t:e+" "+t});return t.replace(n,r.join(","))}).replace(/:host\b/gm,e)+"\n"}).join("\n"))}function O(t){function e(){return"data"+(0===u?"":"$"+u)}function n(t){for(var n=void 0,r="",c=0;n=R.exec(t);)if(!(n.index<c)){var s=t.substring(c,n.index).trim();s.length>0&&(r+="'"+s.replace(/\n/g,"").replace(/'/g,"\\'")+"', "),c=n.index+n[0].length;var l=n[1],f=l.substr(1);if("#"===l[0])r+="spread(toArray("+e()+", '"+f+"').map(function (entry, index, arr) {\n\t\t\t\t\t\tvar data$"+(u+1)+" = merge({}, data"+(0<=u?"":"$"+u)+", {'.': entry, '.index': index, '.length': arr.length}, entry);\n\t\t\t\t\t\treturn [",u+=1,a=!0,i=!0;else if("/"===l[0]){if(r+="'']; })), ",(u-=1)<0)throw new Error("Unexpected end of block "+l.substr(1))}else"^"===l[0]?(r+="(safeAccess("+e()+", '"+f+"') && safeAccess("+e()+", '"+f+"').length > 0) ? '' : spread([1].map(function() { var data$"+(u+1)+" = merge({}, data"+(0<=u?"":"$"+u)+"); return [",i=!0,u+=1):"%"===l[0]?(r+=l.substr(1).split(/\s*,\s*/).map(function(t){return"renderStyle(safeAccess("+e()+", '"+t+"'), "+e()+")"}).join(" + "),o=!0):"+"===l[0]?r+="safeAccess("+e()+", '"+f+"'), ":"{"!==l[0]?(f=l,r+="safeAccess("+e()+", '"+f+"', true), "):r+="safeAccess("+e()+", '"+f+"'), "}return t.substr(c).length>0&&(r+="'"+t.substr(c).replace(/\n/g,"").replace(/'/g,"\\'")+"', "),r}var r={styles:[],helperFunctions:[Z],tagName:"",render:"",functions:""},a=!1,o=!1,i=!1,c=void 0,s=0,u=0,l=[];for(t=t.replace(D,"").replace(/<(script|style)[^>]*?>((?:.|\n)*?)<\/\1>/gi,function(t,e,n){return"style"===e?r.styles.push(n):r.functions+=n.trim().replace(/;$/,""),""}).trim(),r.tagName=t.match(/^<([\w_-]+)>/)[1].toLowerCase();c=U.exec(t);)if(!(c.index<s)){var f=t.substring(s,c.index).replace(/^[ \t]+|[ \t]$/g," ").trim();if(s=c.index+c[0].length,f.length>0&&(r.render+=n(f)),c[2]!==r.tagName)if(c[1]){var d=l.pop();if(d!==c[2])throw new Error("Unexpected end of tag: "+c[2]+"; expected to end "+d);r.render=r.render.replace(/,\s*$/g,"")+")), "}else{l.push(c[2]);var h=function(t){for(var e="{",r=void 0;r=V.exec(t);)"{"!==e&&(e+=", "),e+='"'+r[1].toLowerCase()+'": '+n(r[2]||r[3]).replace(/,\s*$/,"");return e+"}"}(c[3]);r.render+="new Tag('"+c[2]+"', "+h,c[4]?(r.render+="), ",l.pop()):r.render+=", [].concat("}}if(l.length>0)throw new Error("Unclosed tags: "+l.join(", "));return t.substr(s).trim().length>0&&(r.render+=n(t.substr(s).replace(/^[ \t]+|[ \t]$/g," ").trim())),r.render=r.render.replace(/,\s*$/g,""),a&&(r.helperFunctions.push(G),r.helperFunctions.push(P)),i&&r.helperFunctions.push(J),o&&r.helperFunctions.push(X),r.functions=r.functions||"{}",r.styles=r.styles.length>0?"styles: "+JSON.stringify(r.styles)+",":"",r.helperFunctions=r.helperFunctions.join("\n"),B.replace(R,function(t,e){return r[e]})}function L(t,e){return[].slice.call(e.querySelectorAll(t))}var C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T=function(t){return"object"===(void 0===t?"undefined":C(t))},S=function(t){return"function"==typeof t},k=function(){},H=[],$=[],M={},z={},F={},q={props:{},mount:k,unmount:k,render:k,getHost:function(){return this},setProps:function(e,n){var r=this.getHost();T(e)?t(r.props,e):r.props[e]=n,r.mounting||f("--zino-rerender-tag",r)}};d("--zino-unmount-tag",N),d("--zino-mount-tag",v);var U=/<(\/?)([\w-]+)([^>]*?)(\/?)>/g,V=/([\w_-]+)=(?:'([^']*?)'|"([^"]*?)")/g,D=/<!--(?:[^-]|-[^-])*-->/g,R=/\{\{\s*([^\}]+)\s*\}\}\}?/g,Z="function safeAccess(obj, attrs) {\n\tif (!attrs) return obj;\n\tif (attrs[0] === '.') {\n\t\treturn obj[attrs];\n\t}\n\tattrs = attrs.split('.');\n\twhile (attrs.length > 0 && typeof (obj = obj[attrs.shift()]) !== 'undefined');\n\tif (typeof obj === 'string') {\n\t\treturn obj.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/\"/g, '&quot;').replace(/>/g, '&gt;');\n\t} else {\n\t\treturn obj || '';\n\t}\n}",P="function toArray(data, value) {\n\tvar dataValue = safeAccess(data, value);\n\tif (dataValue) {\n\t\tif (Object.prototype.toString.call(dataValue) === '[object Array]') {\n\t\t\treturn dataValue;\n\t\t} else return [dataValue];\n\t} else {\n\t\treturn [];\n\t}\n}",J="function spread(array) {\n\tvar result = [];\n\tarray.forEach(function(entry) {\n\t\tresult = result.concat(entry);\n\t});\n\treturn result;\n}",G="function merge(target) {\n\t[].slice.call(arguments, 1).forEach(function (arg) {\n\t\tfor (var all in arg) {\n\t\t\ttarget[all] = arg[all];\n\t\t}\n\t});\n\n\treturn target;\n}",X="function renderStyle(value, context) {\n\tvar style = '';\n\t\ttransform = function(val) {\n\t\t\tif (typeof val === 'function') return transform(val.apply(context));\n\t\t\treturn val + (typeof val === 'number' && val !== null ? context.styles && context.styles.defaultUnit || 'px' : '');\n\t\t};\n\n\tif (typeof value === 'object') {\n\t\tfor (var all in value) {\n\t\t\tstyle += all.replace(/[A-Z]/g, g => '-' + g.toLowerCase()) + ':' + transform(value[all]) + ';';\n\t\t}\n\t}\n\n\treturn style;\n}",B="function(Tag) {\n\t{{helperFunctions}}\n\n\treturn {\n\t\ttagName: '{{tagName}}',\n\t\t{{styles}}\n\t\trender: function(data) {\n\t\t\treturn [].concat({{render}})\n\t\t},\n\n\t\tfunctions: {{functions}}\n\t};\n}",I=window.zinoTagRegistry||{},K=void 0,Q=[],W=new MutationObserver(function(t){t.forEach(function(t){var e=t.addedNodes,n=t.removedNodes;e.length>0?[].forEach.call(e,function(t){(t.children&&L("*",t)||[]).concat(t).forEach(function(t){return f("--zino-mount-tag",t)})}):n.length>0&&[].forEach.call(n,function(t){(t.children&&L("[__ready]",t)||[]).concat(t).forEach(function(t){return f("--zino-unmount-tag",t)})})})}),Y=K={on:d,one:g,off:h,trigger:f,fetch:function(t,e,n,r){if(n&&I[t]&&!I[t].callback)return e(I[t],200);if(T(I[t]))return I[t].callback.push(e);if(I[t]=r||{callback:[e]},!r){var a=new XMLHttpRequest;a.open("GET",t,!0),a.onreadystatechange=function(){if(4===a.readyState){var e=I[t].callback;200===a.status&&(I[t]=a.responseText),n||delete I[t],e.forEach(function(t){return t(a.responseText,a.status)})}},a.send()}},import:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k,n=(this.path||"")+t;K.fetch(n,function(t,r){var a=n.replace(/[^\/]+$/g,"");if(200===r){var o=void 0;try{0===t.trim().indexOf("<")&&(t=O(t)),o=new Function("return "+t.replace(/\bZino.import\s*\(/g,"Zino.import.call({path: "+JSON.stringify(a)+"}, ").trim().replace(/;$/,""))()}catch(t){throw t.message="Unable to import tag "+n.replace(/.*\//g,"")+": "+t.message,t}o&&m(o,document.body)}e()},!0)}};return window.Zino=K,d("publish-style",function(t){if("string"==typeof t&&t.length>0){var e=document.createElement("style");e.innerHTML=t,t=e}t&&document.head.appendChild(t)}),d("--zino-rerender-tag",function(t){return Q.indexOf(t)<0&&Q.push(t)}),f("publish-style","[__ready] { contain: content; }"),L('[rel="zino-tag"]',document).forEach(function(t){return K.import(t.href)}),W.observe(document.body,{subtree:!0,childList:!0}),requestAnimationFrame(function t(){for(;Q.length>0;)b(Q.shift());requestAnimationFrame(t)}),Y}();
//# sourceMappingURL=zino.min.js.map