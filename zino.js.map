{"version":3,"file":"zino.js","sources":["src/utils.js","src/mustacheparser.js","src/htmlparser.js","src/events.js","src/core.js","src/zino.js"],"sourcesContent":["/**\n * Merges all objects provided as parameters into the first parameter object\n *\n * @param  {...Object} args list of arguments\n * @return {Object}         the merged object (same as first argument)\n */\nexport function merge (target, ...args) {\n\targs.forEach(arg => {\n\t\tfor (let all in arg) {\n\t\t\tif ((typeof HTMLElement !== 'undefined' && arg instanceof HTMLElement) || typeof propDetails(arg, all).value !== 'undefined' && (!target[all] || propDetails(target, all).writable)) {\n\t\t\t\ttarget[all] = arg[all];\n\t\t\t}\n\t\t}\n\t});\n\n\treturn target;\n}\n\nfunction propDetails(obj, attribute) {\n\treturn isObj(obj) && Object.getOwnPropertyDescriptor(obj, attribute) || {};\n}\n\n/**\n * Creates a diff of two JS objects. Includes attribute position check.\n *\n * @param  {Object} objA\tthe object to be compared\n * @param  {Object} objB \tthe object to compare with\n * @return {Object,Boolean} false if both objects are deep equal, else the values of what is different\n */\nexport function objectDiff(objA, objB) {\n\tlet result = {},\n\t\tpartialDiff;\n\tObject.keys(objA).forEach((key, index) => {\n\t\tif (!isValue(objA, key)) return;\n\t\tif (typeof objB[key] === 'undefined') {\n\t\t\tresult[key] = objA[key];\n\t\t} else if (Object.keys(objB)[index] !== key) {\n\t\t\tlet bKey = Object.keys(objB)[index];\n\t\t\tresult[bKey] = objB[bKey];\n\t\t\tresult[key] = objA[key];\n\t\t} else if (typeof objA[key] !== 'object' || typeof objB[key] !== 'object') {\n\t\t\tif (objA[key] !== objB[key]) {\n\t\t\t\tresult[key] = objB[key];\n\t\t\t}\n\t\t} else if (partialDiff = objectDiff(objA[key], objB[key])) {\n\t\t\tresult[key] = partialDiff;\n\t\t}\n\t});\n\tObject.keys(objB).forEach((key, index) => {\n\t\tif (!isValue(objB, key)) return;\n\t\tif (typeof objA[key] === 'undefined') {\n\t\t\tresult[key] = objB[key];\n\t\t}\n\t});\n\tif (Object.keys(result).length > 0) return result;\n\treturn false;\n}\n\nexport function error(method, tag, parentException) {\n\tif (parentException) {\n\t\tthrow new Error('Error while calling ' + method + ' function of ' + tag + ': ' + (parentException.message || parentException), parentException.fileName, parentException.lineNumber);\n\t} else {\n\t\tparentException = tag;\n\t\tthrow new Error(method + ': ' + (parentException.message || parentException), parentException.fileName, parentException.lineNumber);\n\t}\n}\n\n/**\n * Checks if the given arguments are the provided types, if they do no match, an exception is thrown.\n *\n * @param  {Array} args \tlist of arguments provided to callee\n * @param  {Array} types \tlist of data types expected for the provided arguments\n * @param  {String} api  \tname of the API (callee name)\n */\nexport function checkParams(args, types, api) {\n\tfor (var all in args) {\n\t\tif (types[all] && typeof args[all] !== types[all]) {\n\t\t\tthrow new Error('API mismatch while using ' + api + ': Parameter ' + all + ' was supposed to be ' + types[all] + ' but ' + (typeof args[all]) + ' was given.');\n\t\t}\n\t}\n}\n\n/**\n * makes sure that accessing attributes on an unknown data value is safe\n *\n * @param  {Mixed} obj \tdata to made safe for attribute access\n * @return {Object}     will always return an object\n */\nexport function safeAccess(obj) {\n\treturn obj || {};\n}\n\nexport function uuid() {\n\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\n\t\tlet r = Math.random() * 16 | 0;\n\t\treturn (c == 'x' ? r : r & 0x3 | 0x8).toString(16);\n\t});\n}\nexport var isObj = obj => typeof obj === 'object';\nexport var isFn = fn => typeof fn === 'function';\nexport var emptyFunc = () => {};\nexport var identity = a => a;\n\nfunction isValue(obj, key) {\n\tlet descriptor = Object.getOwnPropertyDescriptor(obj, key);\n\treturn typeof descriptor.value !== 'undefined' && !isFn(descriptor.value);\n}\n","import {merge, isFn, isObj} from './utils';\n\nconst\n\tsyntax = /\\{\\{\\s*([^\\}]+)\\s*\\}\\}\\}?/g,\n\n\tgetValue = (name, data, noRun) => {\n\t\tlet parts = ['.'],\n\t\t\tobj = data;\n\n\t\tif (obj[name]) {\n\t\t\tparts = [name];\n\t\t} else if (name.length > 1) {\n\t\t\tparts = name.split('.');\n\t\t}\n\n\t\twhile (obj && parts.length > 0) {\n\t\t\tobj = obj[parts.shift()];\n\t\t}\n\n\t\tif (!noRun && isFn(obj)) {\n\t\t\tobj = obj.apply(data);\n\t\t}\n\t\treturn obj !== undefined && obj !== null ? obj : '';\n\t},\n\n\thandleBlock = (match, data, code, options, depth, startIdx) => {\n\t\tlet ch = match[0],\n\t\t\tkey = match.substr(1).trim(),\n\t\t\tcondition = getValue(key, data, true),\n\t\t\tparsed = '',\n\t\t\tresult = '';\n\n\t\tif (ch === '^' && (!condition || condition && condition.length <= 0)) {\n\t\t\tcondition = true;\n\t\t} else if (ch === '^') {\n\t\t\tcondition = false;\n\t\t}\n\n\t\tif (condition) {\n\t\t\tif (!isObj(condition)) {\n\t\t\t\tcondition = [condition];\n\t\t\t}\n\t\t\tfor (let all in condition) {\n\t\t\t\tif (all === 'isArray') continue;\n\t\t\t\tlet el = condition[all];\n\t\t\t\tparsed = parse(\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tmerge({}, data, el, {\n\t\t\t\t\t\t\t'.index': all,\n\t\t\t\t\t\t\t'.length': condition.length,\n\t\t\t\t\t\t\t'.': el\n\t\t\t\t\t\t}),\n\t\t\t\t\t\toptions,\n\t\t\t\t\t\tdepth,\n\t\t\t\t\t\tstartIdx\n\t\t\t\t\t);\n\t\t\t\tif (isFn(el)) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tresult += el(parsed.content);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tthrow new Error('Unable to run condition function ' + parsed.content + ' while parsing template: ' + e.message);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresult += parsed.content;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!isObj(parsed)) {\n\t\t\tparsed = parse(code, data, options, depth, startIdx);\n\t\t}\n\n\t\treturn [parsed.lastIndex, result];\n\t},\n\n\tparse = function(code, data, options = {}, depth = 0, startIdx = 0) {\n\t\tlet result = '',\n\t\t\tlastPos = startIdx,\n\t\t\tmatch, key, len, ch,\n\n\t\t\ttransform = val => isFn(val) ? transform(val.apply(data)) : val + (typeof val === 'number' && val !== null ? (data.styles && data.styles.defaultUnit || 'px') : ''),\n\t\t\trenderStyle = name => {\n\t\t\t\tlet value = getValue(name, data),\n\t\t\t\t\tstyle = '';\n\n\t\t\t\tif (isObj(value)) {\n\t\t\t\t\tfor (var all in value) {\n\t\t\t\t\t\tstyle += all.replace(/[A-Z]/g, g => '-' + g.toLowerCase()) + ':' + transform(value[all]) + ';';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn style;\n\t\t\t};\n\n\t\t// reset regexp so that recursion works\n\t\tif (!code.match(syntax)) {\n\t\t\treturn {\n\t\t\t\tcontent: code,\n\t\t\t\tlastIndex: code.length - 1\n\t\t\t};\n\t\t}\n\n\t\twhile ((match = syntax.exec(code))) {\n\t\t\tif (match.index < lastPos) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tresult += code.substr(lastPos, match.index - lastPos);\n\t\t\tch = match[1][0];\n\t\t\tkey = match[1].substr(1).trim();\n\t\t\tlen = match[0].length;\n\t\t\tlastPos = match.index + len;\n\n\t\t\tif ('#^'.indexOf(ch) >= 0) {\n\t\t\t\t// begin of block\n\t\t\t\tlet cresult;\n\t\t\t\t[lastPos, cresult] = handleBlock(match[1], data, code, options, depth + 1, lastPos);\n\t\t\t\tresult += cresult;\n\t\t\t} else if (ch === '/') {\n\t\t\t\t// end of block\n\t\t\t\tif (depth <= 0) {\n\t\t\t\t\tthrow new Error('Unexpected end of block ' + key);\n\t\t\t\t}\n\t\t\t\treturn {lastIndex: lastPos, content: result};\n\t\t\t} else if (ch === '!') {\n\t\t\t\t// comment - don't do anything\n\t\t\t\tresult += '';\n\t\t\t} else if (ch === '%') {\n\t\t\t\t// interpret given values separated by comma as styling\n\t\t\t\tresult += key.split(/\\s*,\\s*/).map(renderStyle).join('');\n\t\t\t} else if (ch === '+') {\n\t\t\t\tvar value = getValue(key, data);\n\t\t\t\tlet id = options.resolveData(key, value);\n\t\t\t\tresult += '--' + id + '--';\n\t\t\t} else if (ch === '{') {\n\t\t\t\t// unescaped content\n\t\t\t\tresult += getValue(key, data);\n\t\t\t} else {\n\t\t\t\t// escaped content\n\t\t\t\tresult += ('' + getValue(match[1], data)).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/\"/g, '&quot;');\n\t\t\t}\n\t\t}\n\t\tresult += code.substr(lastPos);\n\t\tif (depth > 0) {\n\t\t\tthrow new Error('Unable to locate end of block for ' + code.substr(startIdx));\n\t\t}\n\n\t\treturn {\n\t\t\tcontent: result,\n\t\t\tlastIndex: code.length - 1\n\t\t}\n\t};\n\n// parses mustache-like template code\nexport default function(code, data, options = {resolveData: x=>x}) {\n\tvar result = parse(code, data, options);\n\treturn result && result.content || '';\n};\n","const\n\ttagRegExp = /<(\\/?)([\\w-]+)([^>]*?)(\\/?)>/g,\n\tattrRegExp = /([\\w_-]+)=(?:'([^']*?)'|\"([^\"]*?)\")/g,\n\tcommentRegExp = /<!--(?:[^-]|-[^-])*-->/g,\n\tselfClosingTags = 'br,img,input,source,hr,link,meta,wainclude'.split(',');\n\nfunction parseAttributes(match) {\n\tlet attributes = [];\n\tlet attr;\n\n\twhile ((attr = attrRegExp.exec(match))) {\n\t\tlet idx = attributes.push({name: attr[1].toLowerCase(), value: attr[2] || attr[3]}) - 1;\n\t\tattributes[attributes[idx].name] = attributes[idx].value;\n\t}\n\treturn attributes;\n}\n\nfunction DOM(tagName, match, parentNode) {\n\tlet attributes = parseAttributes(match);\n\n\t// make sure all tag names are lower cased\n\ttagName = tagName && tagName.toLowerCase();\n\n\treturn {\n\t\ttagName,\n\t\tattributes,\n\t\tchildren: [],\n\t\tparentNode,\n\t\tget outerHTML() {\n\t\t\tlet attributes = [''].concat(this.attributes.map(attr => attr.name + '=\"' + attr.value + '\"'));\n\t\t\tif (selfClosingTags.indexOf(this.tagName) >= 0) {\n\t\t\t\treturn '<' + this.tagName + attributes.join(' ') + '/>';\n\t\t\t} else {\n\t\t\t\treturn '<' + this.tagName + attributes.join(' ') + '>' + this.innerHTML + '</' + this.tagName + '>';\n\t\t\t}\n\t\t},\n\t\tget innerHTML() {\n\t\t\treturn this.children.map(child => child.text || child.outerHTML).join('');\n\t\t},\n\t\tset innerHTML(value) {\n\t\t\tthis.children = parse(value).children;\n\t\t},\n\t\tget className() {\n\t\t\treturn this.attributes['class'] || '';\n\t\t},\n\t\tgetAttribute(name) {\n\t\t\treturn this.attributes[name];\n\t\t},\n\t\tsetAttribute(name, value) {\n\t\t\tthis.attributes = this.attributes.filter(attr => attr.name !== name);\n\t\t\tvalue !== null && this.attributes.push({name, value});\n\t\t\tthis.attributes[name] = value;\n\t\t},\n\t\tremoveChild(ref) {\n\t\t\tfor (var all in this.children) {\n\t\t\t\tif (this.children[all] === ref) {\n\t\t\t\t\tdelete this.children[all]; // remove element\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport function parse(html, dom = new DOM('root')) {\n\tlet match, lastIndex = 0,\n\t\tcurrentDOM = dom;\n\n\t// remove all comments in code & clean up scripts\n\thtml = html.replace(commentRegExp, '').replace(/<(script|style)[^>]*?>((?:.|\\n)*?)<\\/\\1>/g, (g, x, m) => g.replace(m, m.replace(/(['\"])(.*?)\\1/g, (g, m1, m2) => m1+m2.replace(/</g, '\\\\x3c')+m1))).trim();\n\twhile ((match = tagRegExp.exec(html))) {\n\t\tlet child;\n\t\tlet text = html.substring(lastIndex, match.index).replace(/^[ \\t]+|[ \\t]$/g, ' ');\n\t\tlastIndex = match.index + match[0].length;\n\t\tif (text.length > 0) {\n\t\t\t// if we have any text in between the tags, add it as text node\n\t\t\tcurrentDOM.children.push({text});\n\t\t}\n\t\tif (match[1]) {\n\t\t\t// closing tag\n\t\t\tchild = currentDOM;\n\t\t\tcurrentDOM = currentDOM.parentNode;\n\t\t} else {\n\t\t\t// opening tag\n\t\t\tchild = new DOM(match[2], match[3], currentDOM);\n\t\t\tcurrentDOM.children.push(child);\n\t\t\tif (!match[4] && selfClosingTags.indexOf(child.tagName) < 0) {\n\t\t\t\t// if it's not a self-closing tag, create a nesting level\n\t\t\t\tcurrentDOM = child;\n\t\t\t}\n\t\t}\n\t}\n\t// capture the text after the last found tag\n\tlet text = html.substr(lastIndex);\n\ttext && dom.children.push({text});\n\n\treturn dom;\n}\n\nexport function find(selector, dom) {\n\tlet result = [];\n\n\t// for regular Browser DOM\n\tif (dom && typeof dom.querySelectorAll === 'function') {\n\t\treturn [].slice.call(dom.querySelectorAll(selector));\n\t}\n\n\t// for virtual DOM\n\tdom && dom.children.forEach(child => {\n\t\tlet attr;\n\t\tif (child.text) return;\n\t\tif (selector[0] === '#' && child.attributes.id === selector.substr(1) ||\n\t\t\t(attr = selector.match(/^\\[(\\w+)\\]/)) && child.attributes[attr[1]] ||\n\t\t\tselector[0] === '.' && child.className.split(' ').indexOf(selector.substr(1)) >= 0 ||\n\t\t\tchild.tagName === selector.split(/\\[\\.#/)[0]) {\n\t\t\tresult.push(child);\n\t\t}\n\t\tresult = result.concat(find(selector, child));\n\t});\n\treturn result;\n}\n","import {find} from './htmlparser';\nimport {isFn} from './utils';\n\nlet eventQueue = {};\n\nexport function trigger(name, data) {\n\tif (!eventQueue[name]) return;\n\tfor (let index in eventQueue[name]) {\n\t\tname.indexOf('--event-') && trigger('--event-trigger', {name, fn: eventQueue[name][index], data});\n\t\tlet result = eventQueue[name][index](data);\n\t\tif (result === false) break;\n\t}\n}\n\nexport function on(name, fn) {\n\tif (!eventQueue[name]) {\n\t\teventQueue[name] = [];\n\t}\n\teventQueue[name].push(fn);\n\tname.indexOf('--event-') && trigger('--event-register', {name, fn});\n}\n\nexport function off(name, fn) {\n\tif (!isFn(fn)) {\n\t\tdelete eventQueue[name];\n\t\treturn name.indexOf('--event-') && trigger('--event-unregister', {name});\n\t}\n\tfor (let index in eventQueue[name]) {\n\t\tif (eventQueue[name][index] === fn) {\n\t\t\tdelete eventQueue[name][index];\n\t\t\treturn name.indexOf('--event-') && trigger('--event-unregister', {name, fn});\n\t\t}\n\t}\n}\n\nexport function one(name, fn) {\n\ton(name, function self() {\n\t\tfn.apply(this, arguments);\n\t\toff(name, self);\n\t});\n}\n\nexport function attachEvent (el, events, host) {\n\tif (!isFn(el.addEventListener)) return;\n\tlet findEl = (selector, target) => {\n\t\tlet node = find(selector, el);\n\t\twhile (node.length > 0 && target !== host) {\n\t\t\tif (node.indexOf(target) >= 0) return node[node.indexOf(target)];\n\t\t\ttarget = target.parentNode;\n\t\t}\n\t\treturn false;\n\t};\n\tevents.forEach(eventObj => {\n\t\tObject.keys(eventObj.handlers).forEach(event => {\n\t\t\tel.addEventListener(event, e => {\n\t\t\t\tlet target;\n\t\t\t\tif (eventObj.selector === ':host' || (target = findEl(eventObj.selector, e.target))) {\n\t\t\t\t\ttarget && (target.getHost = () => host.getHost());\n\t\t\t\t\teventObj.handlers[event].call(target || host, e);\n\t\t\t\t}\n\t\t\t}, false);\n\t\t});\n\t});\n}\n","import mustache from './mustacheparser';\nimport {parse as html, find as $} from './htmlparser';\nimport {emptyFunc, isFn, isObj, error, uuid, merge} from './utils';\nimport {trigger, on, attachEvent} from './events';\n\nlet tagRegistry = {},\n\tdataRegistry = {},\n\tdefaultFunctions = {\n\t\t'props': {},\n\t\t'mount': emptyFunc,\n\t\t'unmount': emptyFunc,\n\t\t'render': emptyFunc,\n\n\t\tgetHost() { return this; },\n\t\tsetProps(name, value) {\n\t\t\tlet tag = this.getHost();\n\t\t\tif (isObj(name)) {\n\t\t\t\tmerge(tag.props, name);\n\t\t\t} else {\n\t\t\t\ttag.props[name] = value;\n\t\t\t}\n\t\t\tif (!tag.mounting) {\n\t\t\t\ttrigger('--zino-rerender-tag', tag);\n\t\t\t}\n\t\t}\n\t};\n\nexport let renderOptions = {\n\tresolveData(key, value) {\n\t\tlet id = uuid();\n\t\tdataRegistry[id] = value;\n\t\treturn id;\n\t}\n};\n\nexport function registerTag(code, path, document) {\n\tlet firstElement = html(code).children[0],\n\t\ttagName = firstElement.tagName,\n\t\tfunctions;\n\n\t// clean up path\n\tpath = path.replace(/[^\\/]+$/g, '');\n\t// remove recursive tag use and all style/script nodes\n\tcode = code.replace(new RegExp('<\\\\/?' + tagName + '(?:\\s+[^>]+)?>', 'ig'), '').replace(/<(style|script)[^>]*>(?:.|\\n)*?<\\/\\1>/g, '');\n\tfirstElement.code = code;\n\n\tif (tagRegistry[tagName]) {\n\t\t// tag is already registered\n\t\treturn;\n\t}\n\n\thandleStyles(firstElement);\n\tfunctions = handleScripts(firstElement, path);\n\ttagRegistry[tagName] = {functions, code, path, tagName};\n\n\t// initialize all occurences in provided context\n\tdocument && $(tagName, document).forEach(tag => initializeTag(tag, tagRegistry[tagName]));\n}\n\nexport function mount(tag, ignoreRender) {\n\tif (!tag.tagName) return;\n\tlet entry = tagRegistry[tag.tagName.toLowerCase()];\n\tif (!entry || tag.getAttribute('__ready')) return;\n\tif (ignoreRender) entry.functions.render = emptyFunc;\n\treturn initializeTag.call(ignoreRender ? {noEvents: true} : this, tag, entry);\n}\n\nexport function render(tag) {\n\tlet subEvents = renderTag(tag);\n\tattachSubEvents(subEvents, tag);\n}\n\nexport function flushRegisteredTags() {\n\ttagRegistry = {};\n}\n\nfunction initializeTag(tag, registryEntry) {\n\t// check if the tag has been initialized already\n\tif (tag['__s'] || !registryEntry) return;\n\tlet functions = registryEntry.functions,\n\t\tisRendered;\n\n\t// copy all defined functions/attributes\n\tfor (let all in functions) {\n\t\tlet entry = functions[all];\n\t\tif (['mount', 'unmount', 'events', 'render'].indexOf(all) < 0) {\n\t\t\tif (isFn(entry)) {\n\t\t\t\ttag[all] = entry.bind(tag);\n\t\t\t} else {\n\t\t\t\ttag[all] = entry;\n\t\t\t}\n\t\t}\n\t}\n\t// if it has been pre-rendered\n\tif (tag.children.length > 0 && tag.children[0].className === '-shadow-root') {\n\t\tlet sibling = tag.children[1];\n\t\t// remove original HTML content\n\t\tif (sibling && sibling.className === '-original-root') {\n\t\t\ttag.__i = sibling.innerHTML;\n\t\t\tsetElementAttr(sibling, tag);\n\t\t\tsibling.parentNode.removeChild(sibling);\n\t\t}\n\t\tisRendered = true;\n\t} else {\n\t\ttag.__i = tag.innerHTML;\n\t\tsetElementAttr(tag);\n\t\ttag.innerHTML = '<div class=\"-shadow-root\"></div>';\n\t}\n\t// define basic properties\n\tObject.defineProperty(tag, 'body', {\n\t\tset(val) {\n\t\t\ttag.__i = val;\n\t\t\tsetElementAttr(tag);\n\t\t\ttrigger('--zino-rerender-tag', tag.getHost());\n\t\t},\n\t\tget() { return tag.__i; }\n\t});\n\ttag.__s = tag.setAttribute;\n\ttag.setAttribute = function(attr, val) {\n\t\ttag.__s(attr, val);\n\t\ttrigger('--zino-rerender-tag', tag.getHost());\n\t};\n\n\t// call mount callback\n\ttag.props = merge({}, functions.props, getAttributes(tag, true));\n\ttry {\n\t\ttag.mounting = true;\n\t\tfunctions.mount.call(tag);\n\t\tdelete tag.mounting;\n\t} catch (e) {\n\t\terror('mount', tag.tagName, e);\n\t}\n\n\t// render the tag's content\n\tlet subEvents = !isRendered && renderTag.call(this, tag) || {events:[]};\n\n\t// attach events\n\tlet hostEvents = [],\n\t\tevents = functions.events || [],\n\t\tchildEvents = Object.keys(events).filter(all => {\n\t\t\tlet isNotSelf = all !== ':host' && all !== tag.tagName;\n\t\t\tif (!isNotSelf) hostEvents.push({handlers: events[all], selector: all});\n\t\t\treturn isNotSelf;\n\t\t}).map(e => ({selector: e, handlers: events[e]}));\n\n\tsubEvents.events = subEvents.events.concat({childEvents, hostEvents, tag: this && this.noEvents ? tag.tagName : tag})\n\n\tif (!tag.attributes.__ready) {\n\t\ttag.__s('__ready', true);\n\t}\n\tif (!this || this.noEvents !== true) {\n\t\t// attach sub events\n\t\tattachSubEvents(subEvents, tag);\n\t} else {\n\t\treturn subEvents;\n\t}\n}\n\nfunction renderTag(tag, registryEntry = tagRegistry[tag.tagName.toLowerCase()]) {\n\tlet events = [],\n\t\trenderCallbacks = [];\n\n\t// do the actual rendering of the component\n\tlet data = getAttributes(tag);\n\tlet renderedHTML = mustache(registryEntry.code, data, renderOptions);\n\tlet renderedDOM = html(renderedHTML);\n\n\t// render all contained sub components\n\tfor (let all in tagRegistry) {\n\t\t$(all, renderedDOM).forEach(subEl => {\n\t\t\tlet subElEvents = initializeTag.call({\n\t\t\t\tnoRenderCallback: true,\n\t\t\t\tnoEvents: true\n\t\t\t}, subEl, tagRegistry[all]);\n\t\t\tevents = events.concat(subElEvents.events);\n\t\t\trenderCallbacks = renderCallbacks.concat(subElEvents.renderCallbacks);\n\t\t});\n\t}\n\n\t// unmount all existing sub tags\n\t$('[__ready]', tag).forEach(unmountTag);\n\tlet renderedSubElements = $('[__ready]', renderedDOM);\n\t// simply render everything inside\n\ttag.children[0].innerHTML = renderedDOM.innerHTML;\n\trenderedSubElements.length > 0 && $('[__ready]', tag).forEach((subEl, index) => {\n\t\tmerge(subEl, renderedSubElements[index])\n\t\trenderedSubElements[index].getHost = defaultFunctions.getHost.bind(subEl);\n\t});\n\n\tif (!this || !this.noRenderCall) {\n\t\trenderCallbacks.forEach(callback => callback());\n\t\tregistryEntry.functions.render.call(tag);\n\t} else {\n\t\trenderCallbacks.push(registryEntry.functions.render.bind(tag));\n\t}\n\treturn {events, renderCallbacks, data};\n}\n\nfunction attachSubEvents(subEvents, tag) {\n\tlet count = {};\n\tsubEvents.events.forEach(event => {\n\t\tlet el = event.tag;\n\t\tif (!isObj(el)) {\n\t\t\tcount[el] = (count[el] || 0) + 1;\n\t\t\tel = $(el, tag)[count[el] - 1];\n\t\t}\n\t\tattachEvent(el.children[0], event.childEvents, el);\n\t\tattachEvent(el, event.hostEvents, el);\n\t\tisFn(el.onready) && el.onready();\n\t});\n}\n\nfunction unmountTag(tag) {\n\tlet name = (tag.tagName || '').toLowerCase(),\n\t\tentry = tagRegistry[name];\n\tif (entry) {\n\t\t[].forEach.call(tag.attributes, attr => {\n\t\t\t// cleanup saved data\n\t\t\tif (attr.name.indexOf('data-') >= 0) {\n\t\t\t\tdelete dataRegistry[attr.value];\n\t\t\t}\n\t\t});\n\t\ttry {\n\t\t\tentry.functions.unmount.call(tag);\n\t\t} catch (e) {\n\t\t\terror('Unable to unmount tag ' + name, e);\n\t\t}\n\t}\n}\n\nfunction getAttributes(tag, propsOnly) {\n\tlet attrs = {props: tag.props, element: tag.element, styles: tag.styles, body: tag.__i},\n\t\tprops = {};\n\n\t[].forEach.call(tag.attributes, attribute => {\n\t\tlet isComplex = attribute.name.indexOf('data-') >= 0 && attribute.value.substr(0, 2) === '--';\n\t\tattrs[attribute.name] || (attrs[attribute.name] = isComplex ? dataRegistry[attribute.value.replace(/^--|--$/g, '')] : attribute.value);\n\t\tif (attribute.name.indexOf('data-') === 0) {\n\t\t\tprops[attribute.name.replace(/^data-/g, '').replace(/(\\w)-(\\w)/g, (g, m1, m2) => m1 + m2.toUpperCase())] = attrs[attribute.name];\n\t\t}\n\t});\n\n\tif (propsOnly) return props;\n\treturn attrs;\n}\n\nfunction setElementAttr(source, target = source) {\n\tlet baseAttrs = {};\n\t[].forEach.call(source.children, el => {\n\t\tif (el.text) return;\n\t\tlet name = el.tagName.toLowerCase();\n\t\tif (baseAttrs[name]) {\n\t\t\tif (!baseAttrs[name].isArray) {\n\t\t\t\tbaseAttrs[name] = [baseAttrs[name]];\n\t\t\t\tbaseAttrs[name].isArray = true;\n\t\t\t}\n\t\t\tbaseAttrs[name].push(el);\n\t\t} else {\n\t\t\tbaseAttrs[name] = el;\n\t\t}\n\t});\n\ttarget.element = baseAttrs;\n}\n\nfunction handleStyles(element) {\n\tlet tagName = element.tagName;\n\t$('link', element).forEach(link => {\n\t\tif (link.attributes.type === 'stylesheet') {\n\t\t\ttrigger('publish-style', link);\n\t\t}\n\t});\n\ttrigger('publish-style',\n\t\t$('style', element).map(style => {\n\t\t\tlet code = style.innerHTML.replace(/<br>/g, '');\n\t\t\treturn code.replace(/[\\r\\n]*([^@%\\{;\\}]+?)\\{/gm, (global, match) => {\n\t\t\t\tvar selectors = match.split(',').map(selector => {\n\t\t\t\t\tselector = selector.trim();\n\t\t\t\t\tif (selector.match(/:host\\b/) ||\n\t\t\t\t\t\tselector.match(new RegExp(`^\\\\s*${tagName}\\\\b`)) ||\n\t\t\t\t\t\tselector.match(/^\\s*(?:(?:\\d+%)|(?:from)|(?:to)|(?:@\\w+)|\\})\\s*$/)) {\n\t\t\t\t\t\treturn selector;\n\t\t\t\t\t}\n\t\t\t\t\treturn tagName + ' ' + selector;\n\t\t\t\t});\n\t\t\t\treturn global.replace(match, selectors.join(','));\n\t\t\t}).replace(/:host\\b/gm, tagName) + '\\n';\n\t\t}).join('\\n')\n\t);\n}\n\nfunction handleScripts(element, path) {\n\tlet functions = merge({}, defaultFunctions);\n\t$('script', element).forEach(script => {\n\t\tlet text = script.innerHTML.trim();\n\t\tif (script.attributes.src) {\n\t\t\treturn trigger('publish-script', script);\n\t\t}\n\t\ttry {\n\t\t\ttext = text.replace(/\\bZino\\.import\\s*\\(/g, 'Zino.import.call({path: \"' + path + '\"}, ');\n\t\t\tmerge(functions, new Function('return ' + text)());\n\t\t} catch (e) {\n\t\t\terror(`parse script ${text} in tag ${element.tagName}`, e);\n\t\t}\n\t});\n\treturn functions;\n}\n\non('--zino-unmount-tag', unmountTag);\non('--zino-mount-tag', mount);\n","import {registerTag, render} from './core';\nimport {emptyFunc, isObj} from './utils';\nimport {find as $} from './htmlparser';\nimport {on, one, off, trigger} from './events';\n\nlet urlRegistry = window.zinoTagRegistry || {},\n\tZino,\n\tdirtyTags = [],\n\ttagObserver = new MutationObserver(records => {\n\t\trecords.forEach(record => {\n\t\t\tlet added = record.addedNodes,\n\t\t\t\tremoved = record.removedNodes;\n\n\t\t\tif (added.length > 0) {\n\t\t\t\t[].forEach.call(added, tag => {\n\t\t\t\t\t(tag.children && $('*', tag) || []).concat(tag).forEach(subTag => trigger('--zino-mount-tag', subTag));\n\t\t\t\t});\n\t\t\t} else if (removed.length > 0) {\n\t\t\t\t[].forEach.call(removed, tag => {\n\t\t\t\t\t(tag.children && $('[__ready]', tag) || []).concat(tag).forEach(subTag => trigger('--zino-unmount-tag', subTag));\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n\nexport default Zino = {\n\ton, one, off, trigger,\n\n\tfetch(url, callback, cache, code) {\n\t\tif (cache && urlRegistry[url] && !urlRegistry[url].callback) {\n\t\t\treturn callback(urlRegistry[url], 200);\n\t\t} else if (isObj(urlRegistry[url])) {\n\t\t\treturn urlRegistry[url].callback.push(callback);\n\t\t}\n\t\turlRegistry[url] = code || {\n\t\t\tcallback: [callback]\n\t\t};\n\t\tif (code) return;\n\t\tlet req = new XMLHttpRequest();\n\t\treq.open('GET', url, true);\n\t\treq.onreadystatechange = () => {\n\t\t\tif (req.readyState === 4) {\n\t\t\t\tlet callbacks = urlRegistry[url].callback;\n\t\t\t\tif (req.status === 200) {\n\t\t\t\t\turlRegistry[url] = req.responseText;\n\t\t\t\t}\n\t\t\t\tif (!cache) delete urlRegistry[url];\n\t\t\t\tcallbacks.forEach(cb => cb(req.responseText, req.status));\n\t\t\t}\n\t\t};\n\t\treq.send();\n\t},\n\n\timport(path, callback = emptyFunc) {\n\t\tlet url = (this.path || '') + path;\n\t\tZino.fetch(url, (data, status) => {\n\t\t\tif (status === 200) {\n\t\t\t\tregisterTag(data, url, document.body);\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}, true);\n\t}\n};\nwindow.Zino = Zino;\non('publish-style', data => {\n\tif (typeof data === 'string' && data.length > 0) {\n\t\tlet style = document.createElement('style');\n\t\tstyle.innerHTML = data;\n\t\tdata = style;\n\t}\n\tdata && document.head.appendChild(data);\n});\non('publish-script', document.head.appendChild);\non('--zino-rerender-tag', tag => dirtyTags.push(tag));\ntrigger('publish-style', '[__ready] { contain: content; }');\n$('[rel=\"zino-tag\"]', document).forEach(tag => Zino.import(tag.href));\ntagObserver.observe(document.body, {\n\tsubtree: true,\n\tchildList: true\n});\n\nrequestAnimationFrame(function reRender() {\n\tdirtyTags.forEach(render);\n\tdirtyTags = [];\n\trequestAnimationFrame(reRender);\n});\n"],"names":["merge","target","args","forEach","all","arg","HTMLElement","propDetails","value","writable","obj","attribute","isObj","Object","getOwnPropertyDescriptor","error","method","tag","parentException","Error","message","fileName","lineNumber","uuid","replace","r","Math","random","c","toString","isFn","fn","emptyFunc","syntax","getValue","name","data","noRun","parts","length","split","shift","apply","undefined","handleBlock","match","code","options","depth","startIdx","ch","key","substr","trim","condition","parsed","result","el","parse","content","e","lastIndex","lastPos","len","transform","val","styles","defaultUnit","renderStyle","style","g","toLowerCase","exec","index","indexOf","cresult","map","join","id","resolveData","x","tagRegExp","attrRegExp","commentRegExp","selfClosingTags","parseAttributes","attributes","attr","idx","push","DOM","tagName","parentNode","outerHTML","concat","innerHTML","children","child","text","className","filter","ref","html","dom","currentDOM","m","m1","m2","substring","find","selector","querySelectorAll","slice","call","eventQueue","trigger","on","off","one","self","arguments","attachEvent","events","host","addEventListener","findEl","node","keys","eventObj","handlers","event","getHost","tagRegistry","dataRegistry","defaultFunctions","props","mounting","renderOptions","registerTag","path","document","firstElement","functions","RegExp","handleScripts","$","initializeTag","mount","ignoreRender","entry","getAttribute","render","noEvents","subEvents","renderTag","registryEntry","isRendered","bind","sibling","__i","removeChild","defineProperty","__s","setAttribute","getAttributes","hostEvents","childEvents","isNotSelf","__ready","renderCallbacks","renderedHTML","mustache","renderedDOM","subElEvents","subEl","unmountTag","renderedSubElements","noRenderCall","callback","attachSubEvents","count","onready","unmount","propsOnly","attrs","element","body","isComplex","toUpperCase","setElementAttr","source","baseAttrs","isArray","handleStyles","link","type","global","selectors","script","src","Function","urlRegistry","window","zinoTagRegistry","Zino","dirtyTags","tagObserver","MutationObserver","added","record","addedNodes","removed","removedNodes","subTag","url","cache","req","XMLHttpRequest","open","onreadystatechange","readyState","callbacks","status","responseText","cb","send","fetch","createElement","head","appendChild","import","href","observe","requestAnimationFrame","reRender"],"mappings":"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"}